2010-02-01  badlop

	* src/network/exmpp_bosh.erl:
	  Fix exmpp_bosh EDoc compilation

2010-01-29  ppolvorin

	* examples/bosh_client.erl, src/network/exmpp_bosh.erl,
	  src/network/exmpp_session.erl:
	  Fix bugs and add support for specify local IP/port (BOSH
	  connections only)
	  
	  API changes: exmpp_session:connect_BOSH(Session, URL, Server,
	  Port) (where the last parameter was unused)
	  
	  is now: exmpp_session:connect_BOSH(Session, URL, Server, Options)
	  where Options is a (possible empty) list of {local_ip, IP}
	  {local_port, fun() -> integer()}

2010-01-28  badlop

	* include/exmpp_nss.hrl:
	  Update NS_BOSH from Jabber's http-bind to XMPP's bosh (thanks to
	  Karim Gemayel)

2010-01-25  badlop

	* src/network/exmpp_session.erl:
	  Fix processing of presence without From attribute.

	* src/network/exmpp_session.erl:
	  Fix support for SASL ANONYMOUS auth.

2010-01-12  badlop

	* EPLICENCE, c_src/exmpp_compress.h, c_src/exmpp_compress_zlib.c,
	  c_src/exmpp_driver.c, c_src/exmpp_driver.h,
	  c_src/exmpp_stringprep.c, c_src/exmpp_tls.c, c_src/exmpp_tls.h,
	  c_src/exmpp_tls_openssl.c, c_src/exmpp_xml.c, c_src/exmpp_xml.h,
	  c_src/exmpp_xml_expat.c, c_src/exmpp_xml_expat_legacy.c,
	  c_src/exmpp_xml_libxml2.c, doc/overview.edoc,
	  examples/bosh_client.erl, examples/echo_client.erl,
	  examples/echo_component.erl, include/exmpp.hrl,
	  include/exmpp_client.hrl, include/exmpp_nss.hrl,
	  include/exmpp_xml.hrl, include/exmpp_xmpp.hrl, include/jlib.hrl,
	  src/client/exmpp_client_binding.erl,
	  src/client/exmpp_client_compression.erl,
	  src/client/exmpp_client_disco.erl,
	  src/client/exmpp_client_legacy_auth.erl,
	  src/client/exmpp_client_muc.erl,
	  src/client/exmpp_client_privacy.erl,
	  src/client/exmpp_client_pubsub.erl,
	  src/client/exmpp_client_register.erl,
	  src/client/exmpp_client_roster.erl,
	  src/client/exmpp_client_sasl.erl,
	  src/client/exmpp_client_session.erl,
	  src/client/exmpp_client_tls.erl, src/compat/ejabberd_socket.erl,
	  src/compat/ejabberd_zlib.erl, src/compat/jlib.erl,
	  src/compat/stringprep.erl, src/compat/tls.erl,
	  src/compat/xml.erl, src/compat/xml_stream.erl,
	  src/core/exmpp.erl, src/core/exmpp_compress.erl,
	  src/core/exmpp_dialback.erl, src/core/exmpp_internals.erl,
	  src/core/exmpp_iq.erl, src/core/exmpp_jid.erl,
	  src/core/exmpp_message.erl, src/core/exmpp_presence.erl,
	  src/core/exmpp_stanza.erl, src/core/exmpp_stream.erl,
	  src/core/exmpp_stringprep.erl, src/core/exmpp_sup.erl,
	  src/core/exmpp_tls.erl, src/core/exmpp_utils.erl,
	  src/core/exmpp_xml.erl, src/core/exmpp_xmlstream.erl,
	  src/network/exmpp_bosh.erl, src/network/exmpp_component.erl,
	  src/network/exmpp_session.erl, src/network/exmpp_ssl.erl,
	  src/network/exmpp_tcp.erl, src/server/exmpp_server_binding.erl,
	  src/server/exmpp_server_compression.erl,
	  src/server/exmpp_server_legacy_auth.erl,
	  src/server/exmpp_server_privacy.erl,
	  src/server/exmpp_server_sasl.erl,
	  src/server/exmpp_server_session.erl,
	  src/server/exmpp_server_tls.erl, testsuite/check_coverity.erl,
	  testsuite/check_legacy_auth.erl, testsuite/check_stream.erl,
	  testsuite/check_xml_attribute_handlers.erl,
	  testsuite/check_xml_cdata_handlers.erl,
	  testsuite/check_xml_converters.erl,
	  testsuite/check_xml_element_handlers.erl,
	  testsuite/check_xml_path.erl, testsuite/check_xmlstream.erl,
	  testsuite/eunit_tty.erl, testsuite/iq.erl, testsuite/jid.erl,
	  testsuite/stanza.erl, testsuite/xml_attributes.erl,
	  testsuite/xml_parser.erl:
	  Update year of copyright from 2009 to 2010.

2010-01-09  ppolvorin

	* ebin/Makefile.am:
	  Bug fix: exmpp_client_muc.beam was listed twice.

2010-01-06  ppolvorin

	* src/network/exmpp_bosh.erl:
	  Remove uneccesary waits.
	  
	  The spec says that we only need to respect the polling interval
	  if we are sending empty requests. Here we don't send empty
	  requests, so no need to wait.

2009-12-30  ppolvorin

	* src/network/exmpp_bosh.erl:
	  Fix overactivity/inactivity handling.
	  
	  Queue stanzas that can't be sent inmediately, either because we
	  reach the limit on # open requests, or because we are inside the
	  minimum polling period.

2009-12-23  ppolvorin

	* src/client/exmpp_client_binding.erl,
	  src/network/exmpp_session.erl:
	  Support for SASL ANONYMOUS.
	  
	  Note that the API changed, exmpp_session:login/2 returns {ok,
	  JID} instead of only 'ok'.

2009-12-18  ppolvorin

	* src/network/exmpp_session.erl:
	  Rollback #892 (see EXMPP-23).
	  
	  Let the workaround until we find the real reason.

2009-12-15  jpcarlino

	* ebin/Makefile.am, ebin/exmpp.app.in:
	  include exmpp_client_muc module

2009-12-14  ppolvorin

	* examples/bosh_client.erl, src/network/exmpp_session.erl:
	  Do not try to start inets and stringprep each time a new
	  exmpp_session is created.

2009-12-14  badlop

	* configure.ac:
	  Prepare 0.9.2 release.

	* src/core/exmpp_iq.erl, src/core/exmpp_jid.erl,
	  src/core/exmpp_message.erl, src/core/exmpp_presence.erl,
	  src/core/exmpp_stanza.erl, src/core/exmpp_stream.erl,
	  src/core/exmpp_stringprep.erl, src/core/exmpp_xml.erl,
	  src/core/exmpp_xmlstream.erl:
	  Revert a recent commit about bool and boolean because it only
	  works with R13 (EXMPP-22)

2009-12-14  kgemayel

	* src/client/exmpp_client_disco.erl:
	  exmpp_client_disco.erl : fix iq_id to iq_id()

	* ebin/exmpp.app.in:
	  ebin/exmpp.app.in : update for exmpp_client_disco.erl

	* ebin/Makefile.am:
	  ebin/Makefile.am : update for exmpp_client_disco.erl

	* src/Makefile.am:
	  src/Makefile.am : update for exmpp_client_disco.erl

	* src/Emakefile.in:
	  src/Emakefile.in : update for exmpp_client_disco.erl

	* doc/Makefile.am:
	  doc/Makefile.am : update for exmpp_client_disco.erl

	* src/client/exmpp_client_disco.erl,
	  src/client/exmpp_client_pubsub.erl:
	  new client/exmpp_client_disco.erl module added

	* src/client/exmpp_client_pubsub.erl:
	  client/exmpp_client_pubsub.erl : remove ?IQ, ?IQ_GET and ?IQ_SET
	  macros (now defined in include/exmpp_xmpp.hrl) ; fix indentation

	* include/exmpp_xmpp.hrl:
	  include/exmpp_xmpp.hrl : add ?IQ, ?IQ_GET and ?IQ_SET macros

2009-12-11  badlop

	* src/core/exmpp_iq.erl, src/core/exmpp_jid.erl,
	  src/core/exmpp_message.erl, src/core/exmpp_presence.erl,
	  src/core/exmpp_stanza.erl, src/core/exmpp_stream.erl,
	  src/core/exmpp_stringprep.erl, src/core/exmpp_xml.erl,
	  src/core/exmpp_xmlstream.erl:
	  Fix warnings about bool() type spec renamed to boolean()

2009-12-11  ppolvorin

	* src/network/exmpp_bosh.erl:
	  Bug fixes and improvements
	  
	  * parse the bosh URL (host, port, etc.) only once per session,
	  not on each request * use a random initial RID * reuse the same
	  exmpp_xmlstream instead of creating a new parser for each
	  received response

2009-12-11  badlop

	* README:
	  expat library is required; the alternative libxml2 is only
	  experimental (EXMPP-16)

	* configure.ac:
	  Autodetect compilation parameters for Mac OS X Snow Leopard
	  (EXMPP-18)

2009-12-08  ppolvorin

	* src/network/exmpp_bosh.erl:
	  Typo fix: the terminating reason and response were in the wrong
	  order

2009-12-04  ppolvorin

	* examples/bosh_client.erl, examples/echo_client.erl,
	  src/network/exmpp_bosh.erl, src/network/exmpp_session.erl:
	  Improve bosh client implementation.
	  
	  It is working, but should be considered a work in progress. It
	  uses SASL PLAIN for authentication.

2009-12-03  ppolvorin

	* src/network/exmpp_session.erl:
	  Remove comment that don't match the code anymore (we can use 1.0
	  streams now)

	* src/network/exmpp_session.erl, src/network/exmpp_ssl.erl,
	  src/network/exmpp_tcp.erl:
	  Adds initial support for "1.0" streams and sasl authentication.
	  
	  For now only the PLAIN mechanism is supported.

2009-11-25  badlop

	* src/network/exmpp_session.erl:
	  Support for stream error stanzas in exmpp_session when logged in
	  (thanks to Julien Barbot)(EXMPP-13)

2009-11-24  badlop

	* doc/Makefile.am, ebin/Makefile.am, src/Makefile.am:
	  Add exmpp_component files to build scripts (thanks to Ery
	  Lee)(EXMPP-8)

2009-11-24  ppolvorin

	* src/network/exmpp_session.erl, src/network/exmpp_ssl.erl,
	  src/network/exmpp_tcp.erl:
	  Bugfix: handling of connection shutdown and unexpected
	  disconnections. Includes patch from (EXMPP-8).
	  
	  Fix the order of connection shutdown, be sure to close the stop
	  reading from socket before closing the parser port.
	  
	  Notify the exmpp_session process when the tcp connection breaks,
	  not the client process. (thanks to Ery Lee.)

2009-11-23  ppolvorin

	* src/core/exmpp_iq.erl:
	  Bug fix: do not crash on get_payload_ns_as_atom/1 if there is no
	  payload. Return 'undefined' instead.

2009-11-13  ppolvorin

	* doc/Makefile.am:
	  Bug fix: exmpp_compress was listed twice in the /doc Makefile.

2009-11-02  ppolvorin

	* src/core/exmpp_iq.erl, src/network/exmpp_component.erl,
	  src/network/exmpp_session.erl:
	  Populate the querydns field for IQ packets (EXMPP-14)
	  
	  The field querydns of the received_packet record wasn't used.
	  Thanks to pablo platt.

2009-11-01  badlop

	* c_src/exmpp_stringprep.c:
	  Fix stringprep Bidi checking (thanks to Alexey
	  Shchepin)(EXMPP-17)

2009-10-20  ppolvorin

	* src/server/exmpp_server_legacy_auth.erl:
	  Small bug fix: fix the code that includes suplied username into
	  legacy auth form

2009-10-01  ppolvorin

	* c_src/exmpp_xml_expat.c, testsuite/xml_parser.erl:
	  Fix bug when parsing empty namespaces with expat (EXMPP-11)
	  (thanks to Nathan Zorn)
	  
	  The bug causes the VM to segfault when parsing XML content that
	  has a declaration like <b xmlns=''> . Testcase added.

2009-09-21  badlop

	* ebin/exmpp.app.in:
	  Replace wrong mention of exmpp_stanzas to exmpp_stanza (thanks to
	  Pablo Platt)(EXMPP-12)

	* src/server/exmpp_server_compression.erl:
	  Fix namespace in compression's method element.

2009-09-14  ppolvorin

	* src/core/exmpp_jid.erl, src/network/exmpp_component.erl,
	  src/network/exmpp_session.erl:
	  from field of #received_packets becomes {lnode, lomain,
	  lresource} Thanks to Eric Cestari (EXMPP-3).
	  
	  Also a new function to_lower/1 was added to exmpp_jid.

2009-09-09  ppolvorin

	* ebin/Makefile.am, src/Emakefile.in, src/Makefile.am,
	  src/client/exmpp_client_muc.erl:
	  Add helper functions for MUC managment.
	  
	  Only kick and ban stanzas for now.

2009-09-08  ppolvorin

	* src/network/exmpp_component.erl:
	  Fix #xmlcdata type (thanks dialyzer!)

2009-08-28  ppolvorin

	* src/core/exmpp_internals.erl, src/core/exmpp_tls.erl:
	  Fix documented and expected type of
	  exmpp_internals:gen_getopts/2.
	  
	  Correct return type is {ok, [Opt]} instead of [Opt]

2009-08-23  kgemayel

	* src/client/exmpp_client_pubsub.erl:
	  Fix exmpp_client_pubsub:get_owner_affiliations/3

	* src/client/exmpp_client_pubsub.erl:
	  Fix exmpp_client_pubsub:set_owner_affiliations/3

	* src/client/exmpp_client_pubsub.erl:
	  Fix exmpp_client_pubsub:set_owner_affiliations/3

2009-08-20  ppolvorin

	* doc/Makefile.am, ebin/Makefile.am, ebin/exmpp.app.in,
	  examples/echo_component.erl, src/Emakefile.in, src/Makefile.am,
	  src/network/exmpp_component.erl:
	  External component support (EXMPP-8) thanks to Ery Lee.
	  
	  Helper module to write external components using exmpp.

2009-08-18  ppolvorin

	* src/client/exmpp_client_roster.erl:
	  support roster groups in exmpp_client_roster:set_item/4

2009-08-03  badlop

	* README:
	  Emphasize that autoconf patch is only required in old 2.62 and
	  2.63.
	  
	  2.63b and the recent 2.64 are reported to be fixed: News on
	  Erlang support in GNU Autoconf 2.64
	  http://www.berabera.info/en/node/193

2009-07-17  badlop

	* include/exmpp_nss.hrl:
	  Add NS_SERVERINFO for XEP-0157.

2009-06-30  badlop

	* include/exmpp_nss.hrl:
	  Add NS_MSGOFFLINE for XEP-0160.

2009-06-12  kgemayel

	* src/client/exmpp_client_pubsub.erl:
	  fix exmpp_client_pubsub:publish/4

2009-06-11  kgemayel

	* src/client/exmpp_client_pubsub.erl:
	  exmpp_client_pubsubs : some fixes ; new macros added :
	  ?PUBSUB(NS, Children), ?IQ_SET(Service, Id), ?IQ_GET(Service, Id)

2009-06-10  kgemayel

	* src/client/exmpp_client_pubsub.erl:
	  fix exmpp_client_pubsub

	* src/client/exmpp_client_pubsub.erl:
	  fix exmpp_client_pubsub

	* src/client/exmpp_client_pubsub.erl:
	  fix exmpp_client_pubsub

	* src/client/exmpp_client_pubsub.erl:
	  fix exmpp_client_pubsub

	* src/client/exmpp_client_pubsub.erl:
	  fix exmpp_client_pubsub

	* src/client/exmpp_client_pubsub.erl:
	  fix exmpp_pubsub_client

2009-06-08  kgemayel

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : fix publish/2

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : set_owner_affiliations/3,
	  set_owner_affiliations/4

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : publish/2 (aka as PEP)

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : get_owner_affiliations/2,
	  get_owner_affiliations/3

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : set_owner_subscriptions/3,
	  set_owner_subscriptions/4

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : get_owner_subscriptions/2,
	  get_owner_subscriptions/3

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : purge_items/2, purge_items/3

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : get_default_configuration/2,
	  get_default_configuration/3

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : fix @spec for
	  set_node_configuration/3 and set_node_configuration/4

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : set_node_configuration/3,
	  set_node_configuration/4

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : get_node_configuration/2,
	  get_node_configuration/3

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : create_and_configure_node/3,
	  create_and_configure_node/4

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : create_instant_node/1,
	  create_instant_node/2

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : retract/3, retract/4

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : fix get_items_max/3

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : get_items_max/3,
	  get_items_max/4

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : fixing get_items_by_id/3

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : get_items_by_id/3,
	  get_items_by_id/4

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : get_items/2, get_items/3

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : subscribe_and_configure/4,
	  subscribe_and_configure/5

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : get_subscriptions_options/3,
	  get_subscriptions_options/4, set_subscriptions_options/4,
	  set_subscriptions_options/5

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : unsubscribe/3 and unsubscribe/4

	* src/client/exmpp_client_pubsub.erl:
	  Extending 'exmpp_client_pubsub' : get_affiliations/1,
	  get_affiliations/2, get_subscriptions/1 and get_subscriptions/2

2009-06-03  badlop

	* src/core/exmpp_internals.erl, src/core/exmpp_stream.erl,
	  src/core/exmpp_tls.erl, src/core/exmpp_xml.erl,
	  src/network/exmpp_session.erl:
	  Fix indentation

	* src/network/exmpp_bosh.erl:
	  Fix header include. Add ifdef to bosh_send_async/5 definition.

	* Makefile.am:
	  Include the ChangeLog file in released packages.

	* ChangeLog, Makefile.am:
	  No longer edit ChangeLog, will be auto generated for exmpp
	  releases.
	  
	  Added new call 'make changelog' which generates a ChangeLog file
	  by prepending to the old file obtained from SVN the new lines
	  obtained from SVN Log and formatted with svn2cl. ChangeLog will
	  be generated and included in exmpp releases.

	* README, configure:
	  Revert my previous idea; in SVN you need to run autoreconf to
	  build several files.

2009-06-03  mremond

	* examples/Emakefile.in:
	  Now build BOSH client in example

	* configure, src/Makefile.am:
	  Fix typo in makefile

2009-06-01 Karim Gemayel <kgemayel@process-one.net>

	* src/core/exmpp_jid.erl: API renaming :
	         prepd_bare_to_binary -> prep_bare_to_binary ;
	
	API renaming to fix rev789 :
	        prep_bare_jid_to_list -> prep_bare_to_list 

2009-05-30  Badlop  <badlop@process-one.net>

	* src/core/exmpp_jid.erl: Fix function name collision: old
	internal function to_binary/1 renamed to storbi2bi/1. Rename
	compare/2 to full_compare/2 and add compare/2 which just calls
	full_compare/2.

2009-05-29 Karim Gemayel <kgemayel@process-one.net>

        * examples/bosh_client.erl : API renaming :
                make_jid -> make ;
        * examples/echo_client.erl : API renaming :
                make_jid -> make ;
        * include/internal/exmpp_xmpp.hrl : API renaming :
                make_jid -> make ;
                ldomain -> prep_domain ;
                lnode -> prep_node ;
                lresource -> prep_resource ;
        * include/jlib.hrl : API renaming :
                lresource -> prep_resource ;
        * src/client/exmpp_client_binding.erl : API renaming :
                parse_jid -> parse ;
        * src/compat/jlib.erl : API renaming :
                make_jid -> make ;
                parse_jid -> parse ;
                lresource -> prep_resource ;
                jid_to_list -> to_list ;
        * src/core/exmpp_jid.erl : API renaming :
                make_jid -> make ;
                jid_to_bare_jid -> bare ;
                bare_jid_to_jid -> full ;
                parse_jid -> parse ;
                ldomain -> prep_domain ;
                ldomain_as_list -> prep_domain_as_list ;
                lnode -> prep_node ;
                lnode_as_list -> prep_node_as_list ;
                lresource -> prep_resource ;
                lresource_as_list -> prep_resource_as_list ;
                compare_jids -> compare ;
                compare_bare_jids -> bare compare ;
                jid_to_list -> to_list ;
                prepd_jid_to_list -> prep_to_list ;
                bare_jid_to_list -> bare_to_list ;
                prepd_bare_jid_to_list -> prep_bare_to_list ;
                jid_to_binary -> to_binary ;
                prepd_jid_to_binary -> prep_to_binary ;
                bare_jid_to_binary -> bare_to_binary ;
        * src/core/exmpp_stanza.erl : API renaming :
                parse_jid -> parse ;
                jid_to_binary -> to_binary ;
        * src/server/exmpp_server_binding.erl : API renaming :
                jid_to_binary -> to_binary ;
        * testsuite/jid.erl : API renaming :
                make_jid -> make ;
                jid_to_bare_jid -> bare ;
                bare_jid_to_jid -> full ;
                parse_jid -> parse ;
                ldomain -> prep_domain ;
                ldomain_as_list -> prep_domain_as_list ;
                lnode -> prep_node ;
                lnode_as_list -> prep_node_as_list ;
                lresource -> prep_resource ;
                compare_jids -> compare ;
                compare_bare_jids -> bare compare ;
                bare_jid_to_list -> bare_to_list ;
                jid_to_binary -> to_binary ;
                bare_jid_to_binary -> bare_to_binary ;

2009-05-17  Mickael Remond  <mremond@process-one.net>

	* src/core/exmpp_xmlstream.erl: Add option to remove enclosing Bosh tag
	(body).

	* src/network/exmpp_bosh.erl: Preliminary bosh support (XEP-0124).
	* src/network/exmpp_session.erl: Likewise.

	* examples/bosh_client.erl: Example / test bosh client.

2009-04-24  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_presence.erl (set_type/2, set_show/2): Instead of
	just checking if the argument is valid, use the 'case' to convert the
	arguemnt to binary() too.

	* src/core/exmpp_message.erl: Add contracts.
	(set_type/2): Support binary() and string() correctly.
	(set_subject/2, set_body/2, set_thread/2): Treat the empty_binary()
	before the empty string() because now, binary() is the primary data
	type in exmpp.

	* src/core/exmpp_stream.erl: Fix documentation. Add contracts. Remove
	?STREAM_NS_PREFIX in favor of ?NS_XMPP_pfx. To obtain a random ID, use
	the 'random' atom, not 'undefined' as before.
	(serialize_version/1): Return a binary() for consistency's sake.

	* TODO, doc/overview.edoc: Update TODO to remember to rework
	exmpp_xml:node_to_iolist/3.

2009-04-23  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_presence.erl: Add contracts. Fix documentation.
	(set_type/2, set_show/2): Support binary() and string() correctly.

	* src/core/exmpp_stringprep.erl: Add contracts.

2009-04-04  Mickael Remond  <mremond@process-one.net>

	* src/network/exmpp_session.erl: Better handling of stream error:
	Client now gets a proper exception.

2009-04-02  Christophe Romain  <christophe.romain@process-one.net>

	* src/client/exmpp_client_pubsub.erl: Pubsub delete node is now in
	pubsub#owner namespace.

2009-04-01  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/network/exmpp_session.erl, src/client/exmpp_client_register.erl:
	Use is_pid/1, is_atom/1, is_list/1, is_tuple/1 and is_integer/1
	instead of pid/1, atom/1, list/1, tuple/1 and integer/1 respectively.
	The latter are marked obsolete in R13B.

2009-03-30  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/internal/Makefile.am: Install internal headers, for
	information purpose.

	* include/exmpp_xml.hrl: Declare a real type for each record. This
	permits to reference them in modules that do not include this header.

	* src/core/exmpp_xml.erl: Types documentation is moved near the top of
	the file, like other source files. Declare a real type for records
	that may be used by other modules. Fix xmlparseroption() type
	definition. Use types instead of record in contract. Fix many
	contracts; add a command where contracts couldn't be fixed because of
	Dialyzer limitations. Now that R12B is required, use lists:keystore/4
	instead of the replacement function in exmpp_utils.

	* src/core/exmpp_utils.erl (keystore/4): Remove this replacement
	function now that R12B is required.

	* src/core/exmpp_jid.er: Declare a jid() type so that other modules
	can reference it.

	* src/core/exmpp_stanza.erl: Rename the type jid() to jidlike(). It
	shouldn't be confused with exmpp_jid:jid(). It still covers jid(),
	binary() and string().

	* src/core/exmpp_internals.erl: Add contracts. Fix documentation.

	* src/core/exmpp_tls.erl (handshake/6): Fix a bug where a case clause
	could never match. Spotted by Dialyzer.

	* src/core/exmpp_presence.erl (get_show/1): Fix a bug where case
	clauses could never match: the code was expecting string() from a
	function returning binary(). Spotted by Dialyzer.

	* src/core/exmpp_iq.erl: Do not include exmpp_xml.hrl anymore and use
	the new exmpp_stanza:jidlike() type.

	* src/core/exmpp_xmlstream.erl: Declare types to be used in contracts.
	Fix documentation. Remove a useless case clause. Spotted by Dialyzer.

	* c_src/exmpp_xml.c: Correct null pointer checks. Spotted by Clang
	static analyzer.

	* src/core/exmpp_iq.erl (xmlel_to_iq/1): Fix a bug where a conversion
	of a result IQ would crash.
	(get_payload/1): Fix contract.

2009-03-06  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp_xml.hrl: Fix xmldefaultnss() type definition. Add
	definitions for xmldefaultns(), xmlpathcomponent(), xmlel() and
	xmlchild() types.

	* src/core/exmpp_xml.erl: Complete addition of contracts. Fix
	documentation. Rename xmlelement_to_xmlel_and_ns_tables/3 to
	xmlelement_to_xmlel_and_nss_tables/3.
	(append_cdata/2): Change API: this function now works on an XML
	element, not on the children. For the previous behaviour, use the new
	append_cdata_to_list/2 function.

	* src/core/exmpp_stanza.erl: Fix some contracts. Remove useless
	clauses in to_list/2, to_list/1, to_binary/2, to_binary/1, to_iolist/2
	and to_iolist/1.

	* src/core/exmpp_iq.erl: Add contracts. Fix documentation. Fix bugs
	where exmpp_stanza:set_id_in_attrs/2 was called with the old
	'undefined' atom, instead of the new 'random' atom to set a random
	ID.
	(xmlel_to_iq/1): Remove an unused case clause; get_payload/1 will
	never return 'undefined'.

2009-02-24  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp_xml.hrl, include/exmpp_xmpp.hrl,
	include/internal/exmpp_xmpp.hrl: Add type declarations to records.
	This is used by Dialyzer.

	* src/core/exmpp_utils.erl (any_to_list/1, any_to_binary/1): Add new
	functions to convert a string/binary/integer/atom to list and binary
	respectively.

	* src/core/exmpp_xml.erl: Rename some types in documentation:
	  o  xmlelement() -> xmlel_old()
	  o  xmlnsattribute() -> xmlattr()
	  o  xmlattribute() -> xmlattr_old()
	(set_attr_value/2, cdata/1): Use the new any_to_*/1 functions from
	exmpp_utils.

	* src/core/exmpp_stanza.erl: Add contracts. Fix documentation. Style.
	(set_id/2, set_id_in_attrs/2): Change API: an empty ID or undefined
	will remove the attribute. To have a random ID, specify 'random'.
	(set_lang_in_attrs/2): Change API: an empty lang or undefined will
	remove the attribute.
	(error/3): Fix a bug where the 'Text' attribute was never used.

	* src/core/exmpp_jid.erl: Add contracts. Fix documentation. Style.

	* src/core/exmpp_iq.erl, src/core/exmpp_dialback.erl,
	src/core/exmpp_xmlstream.erl: Fix documentation.

	* src/network/exmpp_session.erl: Fix a misuse of gen_fsm's message's
	From. This was not tested, though. Spotted by Dialyzer.

2009-02-23  Pablo Polvorin  <pablo.polvorin@process-one.net>

	* README: State R12B as minimum version.

	* src/core/exmpp_stanza.erl: Use exmpp_jid:jid_to_binary/1.

2009-02-23  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Erlang R12B is now the minimum version to build and use Exmpp.

	* m4/erlang.m4: Add macros to check Erlang release and ERTS version.

	* configure.ac: Check the Erlang release to be R12B. With this new
	requirement, http_base_64 and erl_ddll workarounds aren't neede
	anymore.

	* src/core/exmpp_internals.erl: Remove erl_ddll workaround.

	* src/core/exmpp_utils.erl: Remove http_base_64 workaround and now
	useless helpers.

	* src/server/exmpp_server_sasl.erl, src/client/exmpp_client_sasl.erl:
	Use 'base64' directly now.

2009-02-20  Pablo Polvorin  <pablo.polvorin@process-one.net>

	* src/core/exmpp_jid.erl: Fix bug when trying to extract individual
	components from an empty (non initialized) #jid. 

2009-02-17  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_compress.erl: Fix a typo in proplists module name; we
	were using 'prolists'. Spotted by Dialyzer.

	* src/core/exmpp_jid.erl: Rename as_binary_or_undefined/1 to
	as_binary/1 and remove the clause with 'undefined' because it will
	never happen. Spotted by Dialyzer.

2009-02-11  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* configure.ac: The '-Wall' option to the compiler is GCC-specific.
	Only use it when we're using GCC; this fixes the build with Sun Studio
	for instance.

2009-01-29  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/Emakefile.js: Renamed Emakefile.in.js to Emakefile.js.

	* include/internal/exmpp_known_attrs.hrl.js,
	include/internal/exmpp_known_nss.hrl.js,
	include/internal/exmpp_known_elems.hrl.js,
	src/core/exmpp_known_nss.erl.js, src/core/exmpp_known_elems.erl.js,
	src/core/exmpp_known_attrs.erl.js, src/Emakefile.js: Declare all
	variables.

	* include/Makefile.win32, include/internal/Makefile.win32,
	src/Makefile.win32, c_src/Makefile.win32, ebin/Makefile.win3,
	Makefile.win3: Convert to Unix file format.

	* src/Makefile.win32: Define HAVE_EXPAT, HAVE_LIBXML2, HAVE_OPENSSL
	and/or HAVE_ZLIB if the user doesn't disable those features.

2009-01-28  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/internal/exmpp_known_nss.hrl.js,
	include/internal/exmpp_known_elems.hrl.js,
	include/internal/exmpp_known_attrs.hrl.js: Style.

	* src/core/exmpp_known_nss.erl.js, src/core/exmpp_known_elems.erl.js,
	src/core/exmpp_known_attrs.erl.js: Style.

	* Makefile.win32, include/Makefile.win32,
	include/internal/Makefile.win32, src/Makefile.win32,
	src/Emakefile.in.js, ebin/Makefile.win32, ebin/exmpp.app.js: Add
	Makefiles for Windows environments.

2009-01-20  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_iq.erl: Use correct eDoc types.

	* src/server/exmpp_server_sasl.erl (next_step/1): Mechanism is
	returned as a string() again. It may go back to binary() in a future
	version but the response should be binary() too in this case.

	* include/internal/exmpp_xmpp.hrl, src/core/exmpp_jid.erl,
	testsuite/jid.erl: Rename full_jid to orig_jid because it may not
	contain a full JID but a bare JID.

	* include/internal/exmpp_xmpp.hrl: Style.

	* src/core/exmpp_jid.erl: Remove the parse_list/2 function because
	it's not used anymore; this fixes a warning. A lot of fixes and
	updates to the documentation; this unbreak the build. Style and typos.
	(jid_to_binary/3, bare_jid_to_binary/2): Fix a bug where a mix between
	binary() and string() among arguments would cause a crash.

2009-01-22  Pablo Polvorin  <pablo.polvorin@process-one.net>

	* src/core/exmpp_message.erl: Use atoms for common message
	types (normal, chat, groupchat, headline).

	* include/internal/exmpp_xmpp.hrl, include/exmpp_xmpp.hrl,
	src/core/exmpp_jid.erl, testsuite/jid.erl: Change in internal
	JID representation. Instead of storing the three raw components
	separately, we keep the original JID in one chunk. The
	intention is to save some memory. Most of the time we already
	have the raw JID (for example coming from a stanza), so we
	avoid the need of allocating a new binary when serializing (we
	can return the original, see make_jid/4). Also we allocate
	less pointers by keeping the JID in one chunk instead of in
	its three separate components. Tradeoff: we consume more CPU
	and memory for accessing a single raw component (see
	exmpp_jid:node/1, exmpp_jid:domain/1, exmpp_jid:resource/1),
	but these are less frequently used than their prepared
	versions (exmpp_jid:lnode/1, exmpp_jid:ldomain/1). Load tests
	performed on ejabberd so far indicate an observable memory
	win when using this representation, with no significant CPU
	cost.

2009-01-20  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_xml.erl: When converting an XML element from #xmlel
	to #xmlelement, the added xmlns attribute must have its value as
	binary(), not string(); this was a bug. Also add a comment to note
	that converting #xmlattr value to string() during document_to_iolist/1
	is a waste of time in this context.

	* src/compat/xml.erl: Use exmpp_xml:get_attribute*_as_list/3 because
	the xml module always returned string().

	* src/server/exmpp_server_sasl.erl: Document that mechanism names are
	accepted as binary() and will be returned as binary().

	* src/network/exmpp_session.erl: Replace exmpp_xml:get_attribute*/3
	calls by exmpp_xml:get_attribute*_as_list/3 to be sure nothing was
	broken by the API changes.

	* src/core/exmpp_xml.erl: Replace make_attribute/{1,2} by
	attribute/{2,3} to handle the value. These new functions are now used
	through the module instead of direct #xmlattr creation. Rename
	make_element/{1,2} to element/{1,2} and add element/4. Like
	attribute/{2,3}, cdata/1 is now used instead of direct #xmlcdata
	creation.

	* include/exmpp_xml.hrl: Add macros to ease calls to
	exmpp_xml:attribute/2, exmpp_xml:element/{1,2,4} and
	exmpp_xml:cdata/1.

	* testsuite/jid.erl: Include internal/exmpp_xmpp.hrl.

	* testsuite/xml_attributes.erl: Update to use the new
	exmpp_xml:attribute/{2,3} functions.

2009-01-19  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp_xmpp.hrl, include/internal/exmpp_xmpp.hrl,
	include/internal/Makefile.am: Definition of #jid is moved to an
	internal header.

	* src/core/exmpp_jid.erl: Include internal/exmpp_xml.hrl.

2009-01-14  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_stringprep.erl (control_reuse_arg/2): Treat errors
	from control/2 as the first case; this was a regression introduced in
	revision r692.

	* src/core/exmpp_stanza.erl, src/core/exmpp_message.erl: Style.

	* src/core/exmpp_xml.erl: The old attribute tuple requires that the
	value is a string(), not a binary(). Therefore the get_attribute*
	functions family changes:
	  o  get_attribute_from_list/3 and get_attribute/3 will return a
	     string() with an old-format attribute and a binary() otherwise.
	  o  get_attribute_from_list/4 and get_attribute/4 don't change
	     because they only work on the new format.
	  o  get_attribute_from_list_as_list/{3,4} and
	     get_attribute_as_list/{3,4} will always return a string().
	  o  get_attribute_from_list_as_binary/{3,4} and
	     get_attribute_as_binary/{3,4} will always return a binary().

	* src/core/exmpp_jid.erl: When parsing a JID, the caller doesn't have
	to care if it's a binary() or a string(). Thus, the parsing API is
	changed to provide a single entry point:
	  o  parse_jid/1 accepts both binary() and string() input.
	  o  list_to_jid/1 and binary_to_jid/1 are removed.
	At the same time, simplify exception thrown.  Remove support for bare
	JID parsing. Remove make_bare_jid/{1,2} because make_jid/{1,2} provide
	the same thing.

	* src/compat/jlib.erl, src/core/exmpp_stanza.erl,
	src/client/exmpp_client_binding.erl: Update to use
	exmpp_jid:parse_jid/1.

	* testsuite/jid.erl: The test works again.

	* testsuite/eunit_tty.erl (format_test_error/1): Include unexpected
	exceptions if present.
	(beautify_expr/1): Fix to accept non-string() terms.

	* testsuite/stanza.erl, testsuite/xml_attributes.erl,
	testsuite/iq.erl, testsuite/xml_parser.erl: Update to use or expect
	binary() values in new-format attributes.

	* configure.ac, m4/colored-echo.m4: Move the code to output bold text
	during configure to a dedicated M4 file.

	* configure.ac, c_src/Makefile.am, README: Drop cross-compile support
	because native build for Windows will be better.

	* README: Explain what to do if the developer must use autoconf 2.62
	or autoconf 2.63. Add or update informations regarding requirements
	and how to use an alternate Erlang environment.

2009-01-13  Pablo Polvorin  <pablo.polvorin@process-one.net>

	* src/core/exmpp_xml.erl: Use exmpp_known_elems:elem_as_list/1 in
	two places where atom_to_list/1 was still used.

	* src/core/exmpp_stanza.erl, src/core/exmpp_message.erl: Table to
	convert from type(atom) to the corresponding binary value (instead of
	using atom_to_list/1 and list_to_binary/1.

2009-01-13  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* c_src/xmpp_nss.h.awk, c_src/xmpp_nss.h.js, c_src/xmpp_names.h.awk,
	c_src/xmpp_names.h.js, c_src/xmpp_attrs.h.awk, c_src/xmpp_attrs.h.js:
	Remove unused files.

	* include/exmpp_xmpp.hrl, src/core/exmpp_iq.erl,
	src/core/exmpp_message.erl: Style.

	* src/core/exmpp_stream.erl: Update documentation.
	(set_version_in_attrs/2, set_id_in_attrs/2): Treat the empty binary
	the same way the empty string is treated.
	(parse_version/1): Accept string() again.

	* src/core/exmpp_stringprep.erl (control_reuse_arg/2): Don't treat
	errors from control specially. Reformulate a comment more positively.
	Style.

	* src/core/exmpp_xml.erl: Add documentation to new functions. Style.

	* c_src/exmpp_xml.c (make_attribute): Fix the case where the
	attribute's value length isn't provided.

	* src/core/exmpp_jid.erl: Update documentation. Style.
	(bare_jid_to_jid/2): Add support for an automatically generated random
	resource.

	* testsuite/jid.erl: Restore the too_long_identifiers_test_ test
	although it may not work for now (I'm unable to test right now).
	Style.

	* include/exmpp_jid.hrl: Remove this empty header. A new one may added
	later as an internal header.

2009-01-09  Pablo Polvorin  <pablo.polvorin@process-one.net>

	* src/core/exmpp_stanza.erl: get_type/1, get_lang/1 and get_id/1
	return binary().

	* src/core/exmpp_stream.erl: get_id/1, get_lang/1,
	get_initiating_entity/1 and get_receiving_entity/1 return binary().

	* src/core/exmpp_iq.erl : get_type/1 works on binary attributes.

	* src/core/exmpp_message.erl: Likewise.

	* src/core/exmpp_presence.erl: Likewise.

	* src/networ/exmpp_session.erl: Update to newer interfaces.

2009-01-08  Pablo Polvorin  <pablo.polvorin@process-one.net>

	* c_src/exmpp_xml.c, src/core/exmpp_iq.erl, src/core/exmpp_jid.erl,
	src/core/exmpp_stanza.erl, src/core/exmpp_xml.erl, testsuite/iq.erl,
	testsuite/jid.erl, testsuite/stanza.erl: Use binary to represent
	attribute values.

	* src/core/exmpp_stringprep.erl, src/core/exmpp_jid.erl: Fix shared
	binary managment.

2009-01-03  Pablo Polvorin  <pablo.polvorin@process-one.net>

	* src/core/exmpp_jid.erl: Change #jid structure to use binary()
	storage for node, domain and resource.

	* testsuite/jid.erl: Update testsuite.

	* src/network/exmpp_session.erl: Update to new parser options and JID
	API.

	* include/exmpp_jid.hrl, exmpp_xmpp.hrl: Prepare to hide #jid record
	definition. 

2008-12-19  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_presence.erl: style(9).

	* c_src/exmpp_stringprep.c, c_src/exmpp_xml_expat.c,
	c_src/exmpp_xml_legacy.erl, c_src/exmpp_xml_libxml2.c: Change the way
	structures are initialized because the previous initializing style was
	C99 and Visual C++ (and other C++ compilers) doesn't understand this
	standard.

	* c_src/Makefile.win32: Update this makefile for Visual C++ to include
	new port drivers and remove the old built sources.

2008-12-17  Pablo Polvorin  <pablo.polvorin@process-one.net>

	* src/core/exmpp_presence.erl: Bug fix in get_type/1.

2008-12-10  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/internal/exmpp_known_nss.hrl.js,
	include/internal/exmpp_known_elems.hrl.js,
	include/internal/exmpp_known_attrs.hrl.js: Fixed the "usage" string.

	* src/core/exmpp_known_nss.erl.awk, src/core/exmpp_known_nss.erl.js,
	src/core/exmpp_known_elems.erl.awk, src/core/exmpp_known_elems.erl.js,
	src/core/exmpp_known_attrs.erl.awk, src/core/exmpp_known_attrs.erl.js,
	src/Makefile.am, src/Emakefile.in, ebin/Makefile.am: Generate Erlang
	modules to convert known namespaces/elements/attributes to list. This
	benefits from Erlang constants handling and decreases memory
	footprint. Thanks to Pablo Polvorin.

	* src/core/exmpp_xml.erl: Use the new modules to convert known
	namespaces/elements/attributes. Thanks to Pablo Polvorin.
	(node_to_list/3, node_to_binary/3): Remove specific code and use
	node_to_iolist/3.

	* src/network/exmpp_session.erl: Update parser options; they were left
	behind after exmpp_xml updates. Thanks to Pablo Polvorin.

	* src/core/exmpp_xml.erl: Restore get_name_as_atom/1; it was renamed
	as get_names_as_atom/1 when the name_as_atom option was renamed to
	names_as_atom.

	* src/core/exmpp_tls.erl, c_src/exmpp_tls_openssl.c,
	c_src/exmpp_tls.h: Rename COMMAND_SVN_REVISION to
	COMMAND_PORT_REVISION.

2008-12-09  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/internal/exmpp_known_nss.hrl.awk,
	include/internal/exmpp_known_nss.hrl.js,
	include/internal/exmpp_known_elems.hrl.awk,
	include/internal/exmpp_known_elems.hrl.js,
	include/internal/exmpp_known_attrs.hrl.awk,
	include/internal/exmpp_known_attrs.hrl.js: Fix headers generation to
	remove duplicates. Thanks to Pablo Polvorin.

2008-12-08  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* c_src/exmpp_compress.h, c_src/exmpp_compress_zlib.c,
	c_src/exmpp_tls.h, c_src/exmpp_tls_openssl.c, c_src/Makefile.am: Use
	exmpp_driver.c and remove duplicate code.

	* c_src/exmpp_xml_expat_legacy.c, c_src/exmpp_xml_libxml2.c,
	c_src/exmpp_xml_expat.c: style(9).

	* src/core/exmpp_stringprep.erl: When a binary() is given in argument,
	return a binary() too. If the result of STRINGPREP is the same as the
	original string, return the latter and throw away the former; thanks
	to Pablo Polvorin.

	* c_src/exmpp_stringprep.c, c_src/Makefile.am: Use exmpp_driver.h.
	Remove start/stop callbacks and the private data structure as they're
	unused. Rename commands to COMMAND_*.

	* c_src/exmpp_stringprep.c: style(9).

2008-12-08  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Fixed several warnings issued by Intel C Compiler.

	NOTE: With current options, code produced by this compiler is much
	bigger for no performance gain.

	* c_src/exmpp_driver.h, c_src/exmpp_xml.h: Fix "old-style" prototypes.

	* c_src/exmpp_driver.c: prime_table_length must be static.
	(exmpp_ht_dump_keys): Fix a printf(3) format string to properly handle
	an unsigned int.

	* c_src/exmpp_xml.h, c_src/exmpp_xml.c,
	c_src/exmpp_xml_expat_legacy.c: Remove unused arguments.

	* c_src/exmpp_xml.c: known_*_index must be static.

	* c_src/exmpp_xml_expat.c, c_src/exmpp_xml_expat_legacy.c:
	exmpp_xml_cb_make_attributes must be static. Expat error code is an
	enum, not a generic integer.
	
	* c_src/exmpp_xml_expat.c, c_src/exmpp_xml_expat_legacy.c,
	c_src/exmpp_xml_libxml2.c: When affecting bin->orig_bytes[0], cast the
	original integer to char to acknowledge the loss of precision.

2008-12-05  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_xmlstream.erl (start/3): Fix a bug where 'endtag' was
	not renamed to 'emit_endtag'.

	* c_src/exmpp_xml_expat.c: Fix a bug with parser reset: the context
	was not reset.

	* include/exmpp_nss.hrl: Add non-XML Publish-Subscribe namespaces.

2008-12-01  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* README: Add LibXML2 as an optional dependency.

	* TODO, doc/overview.edoc: Character data handling above 'root_depth'
	is fixed.

2008-11-28  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* m4/pkg.m4: Include pkg-config M4 macros because it's still needed
	when pkg-config isn't installed.

	* c_src/exmpp_xml_expat_legacy.c, c_src/exmpp_xml_libxml2.c,
	c_src/exmpp_xml_expat.c: ERL_DRV_FLAG_USE_PORT_LOCKING was always set,
	even when SMP support wasn't available in Erlang. This caused build
	failure with R11B-5 for instance. The extended driver structure
	doesn't exist in R11B-2 and earlier; fix this case.

2008-11-28  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	The following changes greatly improve memory consumption but they
	include some API changes:
	  o  #xmlattr doesn't carry a prefix anymore (the new record
	     is incompatible with the previous one).
	  o  Known lists handling and API is completly new (and incompatible).
	  o  exmpp_xml parser's options have changed:
	       . namespace has been removed.
	       . ns_check, names_check and attrs_check were renamed to
	         check_nss, check_elems and check_attrs.
	       . check_nss, check_elems and check_attrs now take the name
	         of a known list.
	       . endtag was renamed to emit_endtag.
	       . maxsize was renamed to max_size.

	* configure.ac: Add an option to enable/disable SMP support in port
	drivers that use it. Check for LibXML2 presence. Take care of the new
	include/internal/Makefile.

	* include/internal/extract-known-from-specs,
	include/internal/make-specs-list,
	include/internal/exmpp_known_nss.in,
	include/internal/exmpp_known_elems.in,
	include/internal/exmpp_known_attrs.in,
	include/internal/exmpp_known_nss.hrl.js,
	include/internal/exmpp_known_elems.hrl.js,
	include/internal/exmpp_known_attrs.hrl.js,
	include/internal/exmpp_known_nss.hrl.awk,
	include/internal/exmpp_known_elems.hrl.awk,
	include/internal/exmpp_known_attrs.hrl.awk,
	include/internal/Makefile.am, include/Makefile.am,
	c_src/extract-known-from-specs, c_src/make-specs-list,
	c_src/xmpp_nss.h.in, c_src/xmpp_names.h.in, c_src/xmpp_attrs.h.in:
	Known lists are now Erlang headers instead of C headers.

	* include/exmpp_xml.hrl, src/core/exmpp_stream.erl: Remove prefix from
	#xmlattr and #xmlendtag.

	* c_src/exmpp_driver.h, c_src/exmpp_driver.c, c_src/exmpp_xml.h,
	c_src/exmpp_xml.c, c_src/exmpp_xml_expat.c,
	c_src/exmpp_xml_expat_legacy.c, c_src/exmpp_xml_libxml2.c: Improve
	memory consumption. Add support for SMP, though there's room for
	enhancement. Add support for LibXML2.

	* src/core/exmpp_xml.erl: Completly change known list handling and
	API. Change some parser options.

	* testsuite/xml_attributes.erl, testsuite/xml_parser.erl: Update
	testsuite.

	* c_src/contrib/hashtable.h, c_src/contrib/hashtable_private.h,
	c_src/contrib/hashtable.c: A new hashtable is implemented by
	exmpp_driver.c

2008-11-28  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* testsuite/eunit_tty.erl: Rename assert_failed to assertion_failed.
	Accept unknown failure types. Beautify returned value.

	* src/core/exmpp_xmlstream.erl (process_elements/2): Ignore #xmlcdata
	when they're direct children of the stream.

2008-11-24  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	The following changes fix a few things regarding memory consumption
	tracking. They're committed only for the record and will be deprecated
	when the real improvements are committed.

	* src/core/exmpp_xml.erl: Call to the gen_server are made without any
	timeout.

	* c_src/exmpp_xml_expat.c, c_src/contrib/hashtable_private.h: Track
	memory used by hashtable keys. This is where this port driver uses a
	LOT of memory.

2008-11-17  Jérôme Sautret  <jerome.sautret@process-one.net>

	* src/core/exmpp_utils.erl (random_id/1): Fix manual id generation for
	iq.

	* src/core/exmpp_xml.erl: Add cdata/1 and append_cdata/2 helper
	functions.
	(element_to_list/5): Fix empty tags serialization.

	* src/network/exmpp_session.erl: Initialize random number generator
	for id. Stop the parser after closing the stream.

2008-11-12  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* c_src/contrib/hashtable.h, c_src/contrib/hashtable.c: Use
	driver_alloc/driver_free to allocate memory so that Erlang can report
	more accurate statistics.

2008-11-07  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp_nss.hrl: Add a string version of NS_XML.

	* src/core/exmpp_tls.erl: Rename engine_svn_revision/1 to
	engine_port_revision/1. There still remains references to Subversion
	in the code.

	* testsuite/eunit_tty.erl: Pretty print error messages.

	* doc/Makefile.am: Add $(top_builddir)/include to the include
	directories. This is needed for future generated headers.

2008-10-23  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* c_src/exmpp_xml_expat.c, c_src/Makefile.am, c_src/Makefile.unix:
	Remove the workaround for an old libei bug with string encoding.

	* c_src/exmpp_xml_expat.c: erl_interface.h is unused; remove the
	corresponding #include directive.

2008-10-20  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp_nss.hrl: Add string version of MUC namespaces.

	* src/core/exmpp_compress.erl, src/core/exmpp_tls.erl: Follow
	recommandation of erl_ddll regarding driver loading: drivers are
	loaded only once in a central process. Options are now treated as
	standard proplists; one option of exmpp_tls has a new format.

	* src/core/exmpp_xml.erl: Change default options! Namespace support is
	enabled and names are returned as atom.

	* configure.ac: Define HAVE_EXPAT when the Expat XML port driver is
	built.

	* src/core/exmpp_compress.erl (get_engine_from_options),
	src/core/exmpp_tls.erl (get_engine_from_args): Fix behaviour which was
	broken by previous commit.

	* src/core/exmpp_xml.erl: Like exmpp_tls or exmpp_compress, exmpp_xml
	may use several port drivers, though only Expat is available right
	now. Follow recommandations of erl_ddll regarding driver loading:
	drivers are loaded only once in a central process.

	* testsuite/xml_parser.erl: Update to take into account the default
	options change and the fact that exmpp must be started.

	* src/core/exmpp_sup.erl: Start exmpp_xml.

	* src/core/exmpp_xml.erl, c_src/exmpp_xml_expat.c: Rename commands
	from EXPAT_* to COMMAND_*, now that other port drivers may come in.

	* ebin/exmpp.app.in: Fill the registered processes list.

	* src/core/exmpp_xml.erl: It's now possible to serialize an XML
	document to iolist. The use of iolists seems to bring an improvement
	of 40 to 50% in speed over lists.

	* src/core/exmpp_stream.erl, src/core/exmpp_stanza.erl: Add to_iolist
	functions.

2008-10-08  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_jid.erl: Add functions to serialize JIDs using their
	STRINGPREP'd version.

2008-10-01  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_xml.erl: Rename get_lname_as_atom/1 and
	get_lname_as_list/1 to get_name_as_atom/1 and get_name_as_list/1
	respectively. Add add_autoload_known_nss/1, add_autoload_known_names/1
	and add_autoload_known_attrs/1 to populate Exmpp application
	environment with autoloaded known lists.
	(get_ns_as_atom, get_ns_as_list): Use the new as_atom/1 and as_list/1
	functions.

	* testsuite/check_xml_element_handlers.erl: Updated the old testsuite
	as reference.

2008-09-30  Pablo Polvorin  <pablo.polvorin@process-one.net>

	* src/core/exmpp_xml: Add functions to get the local name of an
	element.

2008-09-29  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_iq.erl (error): The case where the function was
	called with an #iq record and a condition (atom) was not implemented,
	causing a crash.

2008-09-23  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_stanza.erl, src/core/exmpp_iq.erl,
	src/core/exmpp_presence.erl, src/core/exmpp_message.erl: Typo in
	modules short description.

	* src/core/exmpp_presence.erl: In documentation, use "presence stanza"
	instead of "<presence/>".
	(error): Rewrite to behave like exmpp_iq:error/2.
	(set_show, set_status, set_priority): Always use
	exmpp_xml:append_child/2 so the caller better controls the order of
	the elements.

	* src/core/exmpp_message.erl: Add functions to create message stanzas.
	Add functions to set the subject, the body and the thread.
	(get_type): When the type isn't specified or isn't recognized, return
	'normal' as mentionned in the RFC.

2008-09-18  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_xml.erl: Add functions set_attribute_in_list/2 and
	set_attribute/2. They work like set_attribute_in_list/{3,4} and
	set_attribute/{3,4} respectively but take an xmlattribute() or an
	xmlnsattribute() in argument. Add a clause to set_attributes/2 to also
	accept xmlattribute() or xmlnsattribute() arguments.

2008-08-26  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_xml.erl: New function remove_whitespaces_deeply/1 to
	operate on the entire XML tree, not only the current node (as
	remove_whitespaces/1).

2008-08-22  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_presence.erl (set_status/1): Accept an empty string
	or an empty binary as the status. In this case, the status element is
	removed.

	* src/core/exmpp_jid.erl (make_jid/3): Accept an empty string as the
	resource, to ease integration with Ejabberd.

	* configure.ac: Rewrite again the way Erlang and its components are
	detected. It's now possible to use --with-erlang to indicate an
	alternate Erlang environment; much easier than filling ERL and ERLC
	variables (EJABP-3). Regarding cross-compilation, --with-erl_interface
	was replaced by --with-host-erlang. This new option should point to
	the Erlang environment used by the future host. The configure script
	will use the ERTS and erl_interface found there. Checks for the need
	of any workarounds will also use the host Erlang. While here, fix a
	bug with --enable-escaping-using-cdata: when not specified, it
	disabled --enable-http_base_64 instead.

	* trunk/c_src/Makefile.am: Use the new ERLANG_ERTS_DIR variable.

	* README: Write more complete instructions on how to build and install
	Exmpp.

2008-08-20  Jérôme Sautret  <jerome.sautret@process-one.net>

	* src/core/exmpp_presence.erl (presence/2): Add presence/2 helper
	function in the API to create a generic presence packet.

	* README: Fix path to examples.

2008-08-14  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_iq.erl (get_result/1): Fix a bug where a text node
	could be returned as a result.

2008-08-12  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp_xmpp.hrl, src/core/exmpp_stanza.erl,
	src/core/exmpp_iq.erl: Add #iq record support. This record ressembles
	a lot to the one in ejabberd. His main purpose is matching, in
	function clause espcecially. Many functions in exmpp_stanza and
	exmpp_iq accept this new record in place of the common #xmlel but not
	all; check the documentation. Also several bugs were fixed, thanks to
	the new tests.
	
	* testsuite/stanza.erl, testsuite/iq.erl: Add tests to check
	exmpp_stanza and exmpp_iq behaviour. These testsuites are not complete
	yet.

2008-08-07  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* testsuite/xml_attributes.erl, testsuite/Makefile.am:
	check_xml_attributes was partly ported to the new testsuite framework.

2008-08-05  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_xml.erl: It's now possible to serialize an XML
	document to binary. The use of binaries seems to bring an improvement
	of 15 to 20% in speed over lists.
	(make_element/1): Fix a bug with the creation of the element; the
	namespace was filled instead of the name.

	* doc/Makefile.am: Add +B arguments to erl(1). With this, Ctrl+C will
	halt the emulator immediatly.

	* src/core/exmpp_stream.erl, src/core/exmpp_stanza.erl: Add to_binary
	functions.

	* src/core/exmpp_jid.erl: Rename *_to_string and string_to_* functions
	to *_to_list and list_to_* respectively, for consistency's sake with
	other modules. Add functions to serialize a JID as a binary, instead
	of a list.

	* src/compat/jlib.erl, src/server/exmpp_server_binding.erl,
	src/core/exmpp_stanza.erl, src/client/exmpp_client_binding.erl,
	testsuite/jid.erl: Update to take into account exmpp_jid API changes.

	* src/server/exmpp_server_binding.erl (bind/2): Use the new
	jid_to_binary/1 function in exmpp_jid.

	* include/exmpp.hrl, include/exmpp_nss.hrl, include/exmpp_xml.hrl,
	include/exmpp_xmpp.hrl, include/Makefile.am: Split the main header in
	multiple ones.

	* testsuite/Makefile.am, testsuite/eunit_tty.erl: eunit_tty only needs
	exmpp_xml.hrl.

	* c_src/xmpp_nss.h.in, c_src/xmpp_nss.h.js, c_src/xmpp_nss.h.awk,
	c_src/Makefile.am, c_src/Makefile.win32, c_src/Makefile.unix,
	c_src/exmpp_xml_expat.c: Rename xmpp_ns.* to xmpp_nss.* for
	consistency's sake.

	* include/exmpp_xmpp.hrl: Improve guard macros. Now they can be used
	in 'if' statements as well.

	* src/core/exmpp_message.erl, src/core/exmpp_presence.erl,
	src/core/exmpp_iq.erl: Add guards to many functions.

2008-08-04  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* configure.ac: Exmpp is not installed under $prefix/lib/exmpp-X.X.X
	but under $prefix/exmpp-X.X.X.

	* examples, src/Makefile.am, src/Emakefile.in,
	doc/Makefile.am, ebin/Makefile.am, Makefile.am, configure.ac: Move
	examples to a dedicated directory. They may be disabled at configure
	time.

	* src/Makefile.am, examples/Makefile.am: Add +B arguments to erl(1).
	With this, Ctrl+C will halt the emulator immediatly.

	* include/xmpp.hrl, include/Makefile.am: xmpp.hrl is unused.

	* src/core/exmpp_xml.erl (get_attribute_from_list, get_attribute):
	Function to get an attribute value now take an additional argument.
	This new argument is returned by the functions if the specified
	attribute isn't found. Before, those functions would always return an
	empty string.

	* src/compat/xml.erl, src/server/exmpp_server_sasl.erl,
	src/core/exmpp_stream.erl, src/core/exmpp_stanza.erl,
	src/network/exmpp_session.erl: Update to use the new
	get_attribute_from_list and get_attribute functions from exmpp_xml.

2008-08-01  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_stanza.erl: Add functions to set both the sender and
	the recipient at the same time.

	* c_src/make-specs-list: Historical XEPs are accepted; some are still
	used in Ejabberd for instance.

	* include/exmpp.hrl: The list of namespaces is now complete. A string
	version is added for each namespace too; this avoids calls to
	atom_to_list. Fix NS_ROSTER_EXCHANGE duplicated definitions.

	* c_src/xmpp_ns.h.in, c_src/xmpp_names.h.in, c_src/xmpp_attrs.h.in:
	Historical XEPs are accepted now. Also some XEPs were updated on July
	31th.

2008-07-31  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_xml.erl: Fix documentation for
	parse_document_fragment/{1,2}. Add functions make_element/{1,2} and
	make_attribute/{1,2} to create simple nodes without knowing the
	records.

2008-07-30  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_xml.erl: Remove *_by_name suffix from function names.
	For example, get_element_by_name/2 is now get_element/2. For
	get_element/{2,3} and get_elements/{2,3}, aliases are still provided
	for backward compatibility, though they're marked as deprecated.
	element_ns_matches/2 was renamed to element_matches_by_ns/2 for
	consistency. Add remove_element/{2,3}, remove_elements/{2,3},
	remove_element_by_ns/2 and remove_elements_by_ns/2 functions.

	* src/core/exmpp_presence.erl (set_show): Fix by using the new
	remove_element function instead of the non-existing remove_child
	function.

	* Makefile.am, c_src/Makefile.am, testsuite/Makefile.am: updateknown
	and check-junit are PHONY targets.

	* Makefile.am: The distdir and any tarball may take a suffix.

	* configure.ac: Remove EXMPP_VERSION and relatives; they're not used
	anywhere. Add EXMPP_SVNREV which contains the Subversion revision of
	the checkout used by the configure script. Add EXMPP_DISTSUFFIX which
	is set to "-r$EXMPP_SVNREV" when this is not a release (the release
	isn't set).

	* src/compat/xml.erl, src/server/exmpp_server_compression.erl,
	src/server/exmpp_server_legacy_auth.erl,
	src/server/exmpp_server_binding.erl, src/core/exmpp_stream.erl,
	src/core/exmpp_stanza.erl, src/core/exmpp_message.erl,
	src/network/exmpp_session.erl, src/client/exmpp_client_binding.erl,
	src/client/exmpp_client_compression.erl,
	src/client/exmpp_client_tls.erl, src/client/exmpp_client_sasl.erl,
	src/client/exmpp_client_session.erl: Update to use the new get_element
	and get_elements functions from exmpp_xml.

	* configure.ac: Do not set EXMPP_RELEASE_DATE; it must be set in a
	release branch. This was only for testing purpose.

	* configure.ac, Makefile.am: Fix make distcheck when EXMPP_SVNREV and
	EXMPP_DISTSUFFIX are used.

2008-07-29  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/network/exmpp_session.erl: Fix compilation warnings.

	* src/core/exmpp_xml.erl (document_to_list, node_to_list): It's
	possible to give a list of elements to these functions. It allows one
	to use them on the return value of parse_document/1 for instance. It's
	also possible to combine an XML process instruction and an XML
	document, or an XMPP stanza and a stream closing.

	* src/core/exmpp_stream.erl (to_list), src/core/exmpp_stanza.erl
	(to_list): Update documentation.

	* src/client/exmpp_client_presence.erl, src/Makefile.am,
	src/Emakefile.in, ebin/Makefile.am, ebin/exmpp.app.in,
	doc/Makefile.am: Remove exmpp_client_presence. exmpp_presence is the
	module to use.

	* include/exmpp.hrl: Remove definitions used by exmpp_client_presence.

	* src/examples/echo_client.erl: Use exmpp_presence instead of
	exmpp_client_presence.

2008-07-25  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_jid.erl (make_jid, jid_to_string): Add function
	clauses that do the same thing as make_bare_jid and
	bare_jid_to_string.

	* include/exmpp.hrl: Add a macro for the namespace
	'http://jabber.org/protocol/stats'.

2008-07-23  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp.hrl: Add a string version of the Ad-Hoc commands
	namespace. Other namespaces will follow as needed.

	* c_src/extract-known-from-specs, c_src/make-specs-list,
	c_src/extract-known-from-schemas, c_src/make-schemas-urls-list,
	c_src/Makefile.am: Rewrite scripts that fetch and extract official
	namespaces and their element and attribute names. The new scripts are
	now based on the HTML XEP list available here:
	http://www.xmpp.org/extensions/all.shtml
	This list is a lot more up-to-date.

	* c_src/xmpp_ns.h.in-local, c_src/xmpp_names.h.in-local,
	c_src/xmpp_attrs.h.in-local: Removed obsolete templates, now that the
	new scripts understand DTDs.

	* c_src/xmpp_ns.h.in, c_src/xmpp_names.h.in, c_src/xmpp_attrs.h.in:
	Update known lists using the new scripts.

2008-07-21  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_xml.erl (get_path): Accept 'cdata_as_list' as a path
	component. Character data are returned as list (instead of binary)
	obviously.

	* src/core/exmpp_presence.erl: Add functions to create subscribe,
	subscribed, unsubscribe, unsubscribed and error presence stanzas. Add
	a function to set the type of a presence stanza.

	* src/core/exmpp_jid.erl: Export functions to make a JID string from
	given node, domain and resource arguments.

	* src/core/exmpp_iq.erl (result): Accept a list of results to put in
	an IQ.

2008-07-17  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp.hrl: Add XBOSH common prefix.

	* src/core/exmpp_xml.erl (node_to_list): Guarantee that the returned
	list is flat. To achieve this, lists:append/1 is used to concatenate
	lists.

	* c_src/exmpp_xml_expat.c, src/core/exmpp_xml.erl
	(forward_declare_ns/3): Elements with xmlns="" (empty default
	namespace) are legal. After reading "XML 1.0" and "Namespaces for XML
	1.0" (which I'm not sure I understand very well), it means that the
	element declaring this and child elements doesn't belong to any
	namespace.  Informations returned by Expat sort of confirm this. The
	port driver and node_to_list/3 were fixed accordingly: such elements
	will have their namespace set to the atom "undefined" and serialized
	properly. FYI, JSJaC sends elements with empty xmlns. Note that empty
	prefixed namespace are illegal.

2008-07-15  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* testsuite/eunit_tty.erl (escape_desc): Characters '_' and '-' are
	kept in filenames.

	* testsuite/xml_parser.erl, testsuite/Makefile.am: Convert XML parser
	test to EUnit.

	* testsuite/check_jid.erl, testsuite/check_xml_parser.erl: Remove
	converted tests.

	* c_src/xmpp_ns.h.in: Remove a namespace used in an example in
	XEP-0072.

	* include/exmpp.hrl: Update namespace macros to include all new
	namespaces from xmpp_ns.h.in.

	* src/server/exmpp_server_compression.erl,
	src/client/exmpp_client_compression.erl: Use the correct namespace
	during features negotiation.

2008-07-11  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* c_src/make-schemas-urls-list, c_src/extract-known-from-schemas,
	c_src/xmpp_ns.h.in-local, c_src/xmpp_names.h.in-local,
	c_src/xmpp_attrs.h.in-local, c_src/Makefile.am, Makefile.am: Add Perl
	scripts to automatically fetch XEP schemas and extract namespaces,
	names and attributes and create the known lists used by
	exmpp_xml_expat.

	* c_src/extract-known-from-schemas: Fix the known namespaces list
	layout.

	* c_src/xmpp_ns.h.in, c_src/xmpp_attrs.h.in, c_src/xmpp_names.h.in:
	Update known lists using the new scripts.

	* c_src/Makefile.am: Distribute the new scripts and local known lists.
	Split the lines containing Vim modelines so that they are not
	interpreted when editing this Makefile.am.

2008-07-09  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_stringprep.erl: Improved exception handling. An
	exception is raised when exmpp isn't started. When a string isn't
	valid, a meaningful exception is raised. Update documentation.

	* src/core/exmpp_jid.erl: Handle exceptions from exmpp_stringprep
	correctly; this was left broken.

	* testsuite/jid.erl: Update testsuite.

	* src/core/exmpp_xml.erl (xmlel_to_xmlement/3, node_to_list/3): It's
	now possible to specify a list of equivalent namespaces in the default
	namespace stack. This is useful for stanzas going from and to
	compatible but different namespaces such as 'jabber:client',
	'jabber:server' and 'jabber:component:accept'. In this example,
	'Default_NS' will be set to [[?NS_JABBER_CLIENT, ?NS_JABBER_SERVER,
	?NS_COMPONENT_ACCEPT], ...].

	* include/exmpp.hrl: Add Jabber Component Protocol namespaces macros.

	* src/core/exmpp_stanza.erl (to_list/2, to_list/3): Add a note about
	equivalent namespaces in exmpp_xml:xmlel_to_xmlelemen/3. Add Server
	Dialback to default prefixed namespace.
	(to_list/1): Add a function which calls to_list/2 with common XMPP
	default namespaces.

	* src/core/exmpp_xml.erl: Fix an old annoyance with 'name_as_atom':
	when functions need to match an attribute/element name or namespace,
	new matching functions will take care of comparison between strings
	and atoms. So now, the user doesn't have to know if a name or a
	namespace is encoded as an atom or a string. But of course, it will be
	faster if he knows the type.

2008-07-08  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_xml.erl: Add functions to remove text nodes
	containing only whitespaces (indentation usually). Add function to
	indent an XML tree (for debugging purpose mostly). Add support to load
	automatically known namespaces/names/attributes lists from exmpp
	application environment; this is disabled by default and can be
	enabled with the 'autoload_known' flag. Add function filter/3, fold/3,
	foreach/2 and map/2 which are equivalent to their counterpart in
	'lists'.

	* testsuite/etest.in: Don't forgot to add $top_builddir/ebin to the
	code path or the testsuite will check the installed exmpp.

	* testsuite/eunit_tty.erl: Use the new indent facility of exmpp_xml
	with the JUnit XML report.

	* TODO, doc/overview.edoc: Update TODO.

	* src/Makefile.am: exmpp_callbacks was removed.

2008-07-07  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_internals.erl (gen_controlling_process): Fix API: the
	second argument (Pid) was missing!

	* src/core/exmpp_stream.erl, src/core/exmpp_compress.erl: Style.

	* src/core/exmpp_xml.erl: Accept atoms and integers as attribute
	value. They're converted to binary internally and it's not possible to
	get them back in their original type.

	* src/core/exmpp_presence.erl: Use exmpp_xml:get_cdata_as_list/1
	instead of binary_to_list/1.

	* src/core/exmpp_xmlstream.erl: A function was left behind: it now
	uses exceptions too.

	* ebin/exmpp.app.in, doc/Makefile.am: exmpp_callbacks was removed.

	* Makefile.am, testsuite/Makefile.am, testsuite/etest.in,
	testsuite/eunit_tty.erl: New testsuite based on EUnit.

	* testsuite/jid.erl: First test; more to come. Old tests are still
	there for this.

	* testsuite/Emakefile.in, testsuite/test.sh, testsuite/testsuite.erl:
	Remove old tools.

	* configure.ac: Check for EUnit and escript(1).

	* configure.ac, Makefile.am, doc/Makefile.am: Rename
	BUILD_DOCUMENTATION to ENABLE_DOCUMENTATION for consistency's sake.

	* src/core/exmpp_internals.erl, src/core/exmpp_xml.erl:
	lists:keystore/4 appeared only in R12B. Use a replacement function.

	* src/core/exmpp_utils.erl, src/Makefile.am, src/Emakefile.in,
	ebin/Makefile.am, ebin/exmpp.app.in, doc/Makefile.am: Add a new module
	to receive misc. functions.

	* src/core/exmpp_internals.erl, src/server/exmpp_server_sasl.erl,
	src/server/exmpp_server_privacy.erl, src/core/exmpp_stream.erl,
	src/core/exmpp_xml.erl, src/core/exmpp_stanza.erl,
	src/core/exmpp_presence.erl, src/client/exmpp_client_binding.erl,
	src/client/exmpp_client_sasl.erl, src/client/exmpp_client_session.erl,
	src/client/exmpp_client_legacy_auth.erl: encode_base64/1,
	decode_base64/1, keystore/4, random_id/0, and random_id/1 have moved
	to exmpp_utils.

	* src/core/exmpp_utils.erl (strip/1, strip/2): Credits Christopher
	Faulet.

2008-07-02  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_jid.erl: Update jid() documentation.

2008-07-01  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_stanza.erl, src/core/exmpp_iq.erl: Accept a standard
	condition as 'Error'. It's much easier to make error stanza with this.

	* src/core/exmpp_iq.erl (error): Fix a bug while setting ID: the
	function to call is exmpp_stanza:set_id_in_attrs/2, not
	exmpp_stanza:set_id/2.

	* testsuite/check_xml_converters.erl: Fix testsuite after
	exmpp_xml:document_fragment_to_list/3 was renamed.

	* src/core/exmpp_iq.erl (error/2, error_without_original/2): Fix
	copy&paste error: use exmpp_stanza:error/2, not exmpp_iq:error/2 to
	build the <error/> element.

	* src/core/exmpp_stanza.erl (set_type/2, set_type_in_attrs/2): Accept
	an atom() as Type. It's more consistent with exmpp_iq:get_type/1 &
	friends return values.

	* src/core/exmpp_iq.erl: Add a function get_kind/1 which tells if an
	<iq/> is a request or a response.

	* src/core/exmpp_xml.erl: Add functions get_ns_as_list/1 and
	get_ns_as_atom/1 to get the namespace of an XML element in an expected
	encoding.

2008-06-30  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* testsuite/test.sh: erl(1) is called with the +B flags so that ^C
	interrupts the process immediately. To terminate the Erlang process,
	we use halt() instead of init:stop(); this is a lot faster and
	acceptable for a testsuite. Add a new 'FAIL' case for $exit_code.

	* testsuite/testsuite.erl: Test modules now use the new
	testsuite:run/1 function. It handles more cleanly the failed tests by
	pretty printing a stack trace and the exception.

	* testsuite/check_xml_attribute_handlers.erl,
	testsuite/check_coverity.erl, testsuite/check_jid.erl,
	testsuite/check_xml_converters.erl, testsuite/check_xmlstream.erl,
	testsuite/check_xml_path.erl, testsuite/check_xml_parser.erl,
	testsuite/check_xml_cdata_handlers.erl,
	testsuite/check_legacy_auth.erl,
	testsuite/check_xml_element_handlers.erl, testsuite/check_stream.erl:
	Use the new testsuite:run/1 function.

	* TODO: Refreshed (but not exhaustive).

	* doc/overview.edoc: Add TODO to the overview.

	* src/core/exmpp_xml.erl: Add functions has_element_by_name/{2,3} and
	has_element_by_ns/2. Fix documentation.

	* TODO, doc/overview.edoc: Update TODO.

	* src/core/exmpp_xml.erl: Rename document_fragment_to_list/3 to
	node_to_list/3 because the first argument is either an XML element or
	an XML text node.

	* src/core/exmpp_stanza.erl: Use the new node_to_list/3.

	* src/core/exmpp_jid.erl: Add a function make_bare_jid/1 to make a JID
	with just a domain. Remove the Ejabberd compat functions; they are
	moved to Ejabberd itself.

2008-06-27  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp.hrl: Add a IS_IM_STANZA guard expression. Clean up
	namespaces list and add their prefix if any.

	* src/server/exmpp_server_legacy_auth.erl,
	src/server/exmpp_server_privacy.erl, src/core/exmpp_dialback.erl,
	src/core/exmpp_stream.erl, src/core/exmpp_stanza.erl,
	src/core/exmpp_xml.erl, src/client/exmpp_client_roster.erl,
	src/client/exmpp_client_register.erl,
	src/client/exmpp_client_legacy_auth.erl,
	testsuite/check_legacy_auth.erl: Use new namespace macro names.

	* src/core/exmpp_stream.erl, src/core/exmpp_stanza.erl: Add functions
	to_list to wrap around exmpp_xml:document_to_list/1 and
	exmpp_xml:document_fragment_to_list/3.

	* testsuite/Makefile.am: Erlang sources depend on include/exmpp.hrl.

2008-06-26  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp.hrl: Add server dialback namespace.

	* src/core/exmpp_xml.erl: Add function declare_ns_here/3 to declare
	additionnal namespaces in an element. Add function
	is_ns_declared_here/2 to known if a specific namespace is declared an
	element.

	* src/core/exmpp_stream.erl: Add function set_dialback_support/1 to
	add server dialback namespace to a stream opening.
	(opening, opening_reply): Accept 'undefined' as the
	receiving/initiating entity: no 'to' or 'from' will be added to the
	opening.

	* src/core/exmpp_stanza.erl: Add function reply_without_content/1 to
	prepare a reply to a stanza without its original content. Fix
	in the documentation.

	* src/core/exmpp_dialback.erl, src/Makefile.am, src/Emakefile.in,
	ebin/Makefile.am, ebin/exmpp.app.in, doc/Makefile.am: Add a module
	exmpp_dialback to create server dialback stanzas.

2008-06-25  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_stanza.erl: Add functions to remove the sender and
	the recipient.

2008-06-24  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_jid.erl: Remove the function to_ejabberd_short_jid/1.
	This is really an internal format and it doesn't belong to exmpp.

	* src/core/exmpp_iq.erl: Remove the function to_ejabberd_iq/1. As for
	to_ejabberd_short_jid, this is an internal format and ejabberd's jlib
	module is best suited for this purpose.

	* include/exmpp.hrl: Add a macro to test JIDs in guard expressions.

	* src/core/exmpp_stanza.erl: The functions that set the sender and the
	recipient now accept #jid as an argument.

	* src/server/exmpp_server_privacy.erl,
	src/client/exmpp_client_privacy.erl, src/Makefile.am,
	src/Emakefile.in, ebin/Makefile.am, ebin/exmpp.app.in,
	doc/Makefile.am: Add modules to read and create IQ for privacy list
	management.

	* src/core/exmpp_stream.erl: Add the function opening_reply/3 which is
	the same as opening_reply/2 but takes a language in 3rd argument.

	* src/core/exmpp_xml.erl (set_cdata_in_list): Accept atoms and
	integers as character data. The function converts them to binary.

	* src/core/exmpp_presence.erl: Add functions to simply create presence
	stanza. Add functions to change show, status or priority values. The
	API is not frozen.

	* src/server/exmpp_server_session.erl (want_establishment): Replace
	exceptions and 'ok' by bool().

	* src/server/exmpp_server_legacy_auth.erl: Add a function to tell if
	the peer wants to know the authentication fields.

	* src/core/exmpp_jid.erl: For JIDs, accept the empty string in
	argument but still use undefined in the #jid construction.

	* src/core/exmpp_presence.erl: Add a function probe/0.

	* src/client/exmpp_client_legacy_auth.erl: Export hex/1.

2008-06-23  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_jid.erl: Add functions to convert to and from
	ejabberd normal and short JID forms.

	* src/core/exmpp_iq.erl: Add functions to convert to the ejabberd #iq
	record.

2008-06-20  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp.hrl, c_src/xmpp_ns.h.in, c_src/xmpp_names.h.in: Add
	vCard namespace. I'm not really good at reading DTD so xmpp_*.h.in
	lists may not be correct. For example, Psi uses attributes 'version'
	and 'prodid' but as I understand the DTD, those should be elements.
	For the record, I used the DTD included in XEP-0054. The bottom line
	is: all this needs a review!

	* src/server/exmpp_server_compression.erl: Add a function
	'selected_method' to get the method chosen by the peer.

	* src/server/exmpp_server_sasl.erl: The 'success' function was
	missing.

	* src/server/exmpp_server_session.erl (want_setablishment): Fix
	documentation: this function always returns 'ok' or throws an
	exception.

	* src/server/exmpp_server_legacy_auth.erl: When building the fields
	list, include the username value if the peer provided one.

	* src/core/exmpp_iq.erl: Add functions 'is_request', 'is_response',
	'is_result' and 'is_error'. Add function 'get_payload' which returns
	the request, the response or the error, depending on the IQ type.

	* src/core/exmpp_stream.erl: Typo. The documentation at the top of the
	module is out-dated.

	* src/core/exmpp_internals.erl (random_id): Add clauses to generate an
	ID without a prefix.

	* src/core/exmpp_xml.erl: Fix a bug with list concatenation. Style.

	* src/core/exmpp_stanza.erl: Change API: the get_* functions now
	return 'undefined' when the corresponding attribute doesn't exist.

2008-06-19  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp.hrl, src/core/exmpp_presence.erl,
	src/core/exmpp_message.erl, src/Emakefile.in, src/Makefile.am,
	ebin/Makefile.am, ebin/exmpp.app.in, doc/Makefile.am: Add
	exmpp_presence and exmpp_message which provides helpers to handle
	presence and message stanza respectively.

	* src/core/exmpp_xml.erl (reset_parser/1): This function was calling
	reset_parser2/2 directly instead of reset_parser/2. Therefore, options
	were not merged and the parser was not actually reset.

2008-06-18  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Caution: XML parser options and exmpp_xmlstream API changed!

	* src/core/exmpp_xml.erl, testsuite/check_xml_parser.erl: Options
	handling was revised a lot:
	    o  Options are now real "proplists". It means that all options
	       starting with "no_" doesn't exist anymore. They're almost all
	       replaced by a tuple '{Key, false}'.
	    o  Previous options are kept in the #xml_parser record.
	    o  A new function reset_parser/2 allows one to change parser
	       options and reset its parsing state.
	This will be useful to get exmpp_xml:start/1 out of
	exmpp_xmlstream:start/{1,2,3}. Also, options documentation was
	updated.

	* src/core/exmpp_xml.erl, c_src/exmpp_xml_expat.c: Rename the few
	remaining occurences of "endelement" to "endtag".

	* src/core/exmpp_xmlstream.erl, testsuite/check_xmlstream.erl: From
	now on, the XML parser must be created by the caller and passed to
	exmpp_xmlstream:start/{2,3}. This allow the caller to control the
	parser; for instance, he can add known names, namespaces or
	attributes. He is responsible to stop the parser and can use the new
	get_parser/1 to get it back. start/1 was removed and stop/1 is now a
	NOOP (but is kept for potential future changes).

	* src/network/exmpp_session.erl: Sync with last exmpp_xmlstream
	changes.

2008-06-17  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* testsuite/Makefile.am: Fix th ERL_FILES and BEAM_FILES: it was
	missing the 'testsuite' module. Fix the command that copy test.sh to
	the final test script: if the script didn't exist before, the copy was
	not made.

	* src/core/exmpp_xml.erl, c_src/exmpp_xml_expat.c,
	c_src/exmpp_expat.c, c_src/Makefile.am, c_src/Makefile.unix,
	c_src/Makefile.win32: Rename exmpp_expat to exmpp_xml_expat. The new
	name use the same model than exmpp_tls_[engine] and
	exmpp_compress_[engine].

	* c_src/Makefile.am: Use a custom directory prefix (execdrivers) to
	install port drivers, instead of the common libdir. This avoids
	recursion (libdir="${libdir}/...") in some cases. Fix CPPFLAGS and
	LDFLAGS for exmpp_compress_zlib; it was using those for OpenSSL, not
	Zlib as it should.

	* configure.ac: Resurrect the --with-erlang flag to indicate Erlang
	root directory. It's used when cross-compiling because this directory
	can't be guessed.

	* c_src/exmpp_stringprep.c: strcat_s() exists when using Microsoft
	Visual C++ but MingW provides the standard strcat(3) instead.
	Therefore we test the use of Visual C++ specifically, not the Windows
	target.

2008-06-17  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Your attention please: #xmlnselement was renamed to #xmlel!

	I repeat: #xmlnselement was renamed to #xmlel!

	You may now resume your daily activities. Thank you.

2008-06-16  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_xml.erl, testsuite/check_xml_converters.erl: Preserve
	attributes order when making the text version.

	* testsuite/Makefile.am: Simplify this Makefile: all shell scripts are
	'built' the same way.

	* testsuite/test.sh: Specify the bar graph column width. It doesn't
	shrink to fit the larger bar anymore.

	* include/exmpp.hrl, src/core/exmpp_stream.erl,
	src/core/exmpp_stanza.erl, src/core/exmpp_iq.erl,
	src/server/exmpp_server_compression.erl,
	src/server/exmpp_server_tls.erl, src/server/exmpp_server_sasl.erl,
	src/server/exmpp_server_session.erl,
	src/server/exmpp_server_legacy_auth.erl,
	src/server/exmpp_server_binding.erl,
	src/client/exmpp_client_binding.erl,
	src/client/exmpp_client_roster.erl,
	src/client/exmpp_client_pubsub.erl,
	src/client/exmpp_client_compression.erl,
	src/client/exmpp_client_tls.erl, src/client/exmpp_client_sasl.erl,
	src/client/exmpp_client_session.erl,
	src/client/exmpp_client_register.erl,
	src/client/exmpp_client_legacy_auth.erl: Change the default value for
	children in #xmlnselement &nd #xmlelement to the empty list. This is a
	more sensible value that will spare systematic initialization.

	* include/exmpp.hrl, src/core/exmpp_stream.erl,
	src/core/exmpp_xmlstream.erl, src/core/exmpp_xml.erl,
	src/network/exmpp_session.erl, c_src/exmpp_expat.c,
	testsuite/check_xml_converters.erl, testsuite/check_xmlstream.erl,
	testsuite/check_xml_parser.erl, testsuite/check_stream.erl: Merge
	#xmlnsendelement and #xmlendelement in #xmlendtag. This is done
	because this notion didn't exist in ejabberd and the name was wrong;
	this record doesn't represent an element. When namespace support is
	disabled, the members 'ns' and 'prefix' are set to 'undefined'.

	* testsuite/Makefile.am: Tests depend on the .beam files AND the .erl
	sources.

	* include/exmpp.hrl: Remove the '#iq" record and the NS_DELAY define.
	They're used by jlib and their definition is in jlib.hrl now.

2008-06-12  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp.hrl, src/core/exmpp_xml.erl, c_src/exmpp_expat.c:
	Rework (again) namespace forward-declaration. It now supports default
	and prefixed namespace and, hopefulily, it works. Caution, the record
	format is changed! Record conversion is also cleaned up. Problems are
	probably remaining if the caller mix atoms and strings for
	namespaces/names/attributes. Add functions to add known namespace,
	names and attributes to the tables used by the port driver. While
	we're at it, implement a simple prefix auto-generation. Fixed
	documentation at several places.
	(get_path): When the target isn't found, return something
	corresponding to the expected data type: 'undefined' for elements, an
	empty list for attributes and an empty binary for character data.

	* testsuite/check_xml_attribute_handlers.erl,
	testsuite/check_xml_converters.erl,
	testsuite/check_xml_cdata_handlers.erl,
	testsuite/check_xml_parser.erl, testsuite/check_xml_path.erl,
	testsuite/check_xmlstream.erl, testsuite/check_legacy_auth.erl,
	testsuite/check_xml_element_handlers.erl, testsuite/check_stream.erl:
	Use the new #xmlnselement record.

	* src/core/exmpp_stream.erl: Use the new #xmlnselement record.

	* src/core/exmpp_xml.erl: Fix a bug in the documentation.

2008-06-09  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	With these commits, exmpp port drivers build with Visual C++ on
	Microsoft Windows.

	* c_src/exmpp_stringprep.c: Visual C++ uses strcat_s() instead of
	strcat().

	* c_src/exmpp_tls.c: Visual C++ uses _stricmp() instead of
	strcasecmp().

	* c_src/contrib/hashtable_private.h: Visual C++ uses __inline instead
	of inline.

	* c_src/exmpp_expat.c: Visual C++ uses _strdup() instead of strdup().
	Fix several comparisons of long with different signedness.

	* c_src/Makefile.win32, c_src/xmpp_ns.h.js, c_src/xmpp_names.h.js,
	c_src/xmpp_attrs.h.js: Add a Makefile and scripts to build port
	drivers on Windows using Visual C++.

2008-06-09  Pablo Polvorin  <pablo.polvorin@process-one.net>

	* src/network/exmpp_session.erl: Use the appropriate options
	when starting the exmpp_xmlstream ({xmlstreamstart,new}).

2008-06-05  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* c_src/exmpp_tls.h, c_src/exmpp_tls_openssl.c: Add support for new
	commands COMMAND_GET_PEER_CERTIFICATE, COMMAND_GET_VERIFY_RESULT and
	COMMAND_QUIET_SHUTDOWN. Rewrite COMMAND_SHUTDOWN to handle uni- and
	bidirectional shutdown.

	* src/compat/ejabberd_socket.erl, src/Emakefile.in, src/Makefile.am,
	ebin/Makefile.am, ebin/exmpp.app.in, doc/Makefile.am: Add
	ejabberd_socket to the compat layer. This is needed to modify how
	STARTTLS is handled in ejabberd: the <proceed/> element must be sent
	before the call to tls:tcp_to_tls/2.

	* src/core/exmpp_internals.erl: Add gen_getopts/2.

	* src/core/exmpp_compress.erl: Remove the 'Length' argument to the
	recv functions. Add recv_data/2. Add getopts/2. Multiple fixes to the
	documentation.

	* src/core/exmpp_tls.erl: Remove the 'Length' argument to the
	recv functions. Add recv_data/2. Add getopts/2. Add
	get_peer_certificate/1 and get_verify_result/1. Add shutdown/{1-3} and
	quiet_shutdown/1. Multiple fixes to the documentation.
	(handshake): The 'active' state of the underlying socket is set to
	false and restored after the handshake. This allows the caller to set
	the socket to {active, once} or {active, true}. Before, the handshake
	would fail because gen_tcp:recv/{2,3} would return {error, einval}.
	(get_engine_from_identity, get_engine_from_verification): These
	functions were not up-to-date regarding the data structures for the
	identity, the peer verification and the options.
	(shutdown, quiet_shutdown, close): The port driver is closed and
	unloaded.
	(engine_get_decrypted_input): The port driver still wants the length
	argument. This should be fixed!

	* src/compat/tls.erl: Synchronize this compat module with the latest
	version from ejabberd (revision 1344).

	* src/core/exmpp_compress.erl (disable_compression, close): The port
	driver is closed and unloaded.

	* src/compat/ejabberd_zlib.erl: Synchronize this compat module with
	the latest version from ejabberd (revision 1344).

	* c_src/tls_drv.c, c_src/ejabberd_zlib_drv.c, c_src/Makefile.am,
	c_src/Makefile.unix: De-orbit old port drivers because the compat
	layer is now ready.

	* src/compat/EXMPP-vendor: Add a file to track the ejabberd revision
	the compat layer is based on.

	* configure.ac: Add a line in the sumary to tell if Expat was found or
	not.

	* c_src/exmpp_tls.h, c_src/exmpp_tls_openssl.c: Move return codes
	definition to the generic header.

	* c_src/exmpp_compress.h, c_src/exmpp_compress_zlib.c,
	c_src/Makefile.am: Add a generic header for all compression port
	drivers. Move some definitions to it.

	* c_src/Makefile.unix: Add compilation instructions for
	exmpp_tls_openssl.so and exmpp_compress_zlib.so.

	* configure.ac: Add a flag to use CDATA sections for text nodes
	escaping.

	* src/core/exmpp_xml.erl: A long standing confusion with CDATA
	handling is now fixed: get_cdata/1 will now return binaries;
	#xmlnselement and #xmlelment store these this way. normalize/1 is also
	fixed to do what it is supposed to do (as specified in the DOM
	specification). document_fragment_to_list/3 now escapes what needs to
	be escaped and doesn't forget to normalize CDATA before. Documentation
	is up-to-date.
	(get_cdata_as_list, get_cdata_from_list_as_list): New functions to get
	character data as string.
	(escape_using_cdata): Support for escaping with CDATA sections instead
	of entities was taken from ejabberd. It's disabled by default.

	* testsuite/check_xml_converters.erl,
	testsuite/check_xml_cdata_handlers.erl, testsuite/check_xml_path.erl:
	Update testsuite to handle above changes.

	* src/server/exmpp_server_sasl.erl,
	src/server/exmpp_server_legacy_auth.erl,
	src/server/exmpp_server_binding.erl, src/core/exmpp_stream.erl,
	src/core/exmpp_stanza.erl, src/client/exmpp_client_binding.erl,
	src/client/exmpp_client_compression.erl,
	src/client/exmpp_client_sasl.erl: Use get_cdata_as_list/1 instead of
	get_cdata/1.

	* src/compat/xml.erl: Use new CDATA escaping support from exmpp_xml.
	(get_cdata): Use exmpp_xml:get_cdata_from_list_as_list/1.

2008-06-04  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	With these changes, ejabberd 2.0.x can run without modifications with
	the exmpp compat layer.

	* src/core/exmpp_xmlstream.erl: Add support for old xmlstreamstart
	tuple. The format to use can be chosen by calling the new start/3
	function. Be careful, the old format is selected by default now,
	instead of the new one as before.
	(start/1): Remove the clause that takes only XML parser options
	because the API is confusing.

	* testsuite/check_xmlstream.erl: Use explicitly the new xmlstreamstart
	format.

	* src/compat/xml_stream.erl, src/Emakefile.in, src/Makefile.am,
	ebin/Makefile.am, ebin/exmpp.app.in, doc/Makefile.am: Add xml_stream
	to the compat layer.

	* src/core/exmpp_xmlstream.erl: A few style changes.

2008-06-03  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_internals.erl (gen_setopts): Fixed a bug where
	'Options' was not passed to the underlying setopts/2 function.

	* src/compat/xml.erl: Synchronize this compat module with the latest
	version from ejabberd repository (revision 1344). This time, the only
	modifications are the calls to exmpp_xml; there's no changes to the
	documentation or the style. It should ease future modifications
	tracking. Also new features missing in exmpp_xml were identified.

	* src/compat/stringprep.erl: Synchronize this compat module with the
	latest version from ejabberd repository (revision 1344). As with xml,
	the modifications are limited to the calls to exmpp_stringprep.

	* include/jlib.hrl, include/Makefile.am, src/compat/jlib.erl: Again,
	reduce diff with jlib from ejabberd repository (revision 1344). The
	new jlib header is added for the old #jid record. It's installed only
	when the compat layer is enabled.

	* src/compat/stringprep.erl (tolower): Fixed a typo in a function
	name.

	* src/core/exmpp_jid.erl, src/compat/jlib.erl: For unspecified node or
	resource, ejabberd expects the empty string, not 'undefined'. Also
	fixed a bug with a call to a non-existing exmpp_jid:jid_to_string/3
	function.

2008-06-02  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_internals.erl, src/core/exmpp_tls.erl,
	src/core/exmpp_compress.erl: Move underlying_recv/2 and
	underlying_send/2 to exmpp_internals. exmpp_tls and exmpp_compress
	were sharing this small piece of code.

	* src/core/exmpp_internals.erl: Fixed a bug with documentation.

	* src/compat/iconv.erl, src/compat/sha.erl, c_src/iconv_erl.c,
	m4/iconv.m4, src/Emakefile.in, src/Makefile.am, c_src/Makefile.unix,
	c_src/Makefile.am, doc/Makefile.am, ebin/Makefile.am,
	ebin/exmpp.app.in, configure.ac: Remove 'iconv' and 'sha' from the
	compat layer as they belong to ejabberd specificaly. Also the
	configure script doesn't check for iconv(3) anymore.

	* src/core/exmpp_compress.erl: Rename compress/2 to
	enable_compression/2. Add function disable_compression/1.

	* src/core/exmpp_internals.erl, src/core/exmpp_tls.erl,
	src/core/exmpp_compress.erl: Add functions setopts/2, peername/1 and
	sockname/1.

2008-05-23  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* configure.ac: Reorganize the final summary and add bold titles to
	make the output more readable.

	* src/core/exmpp_compress.erl: Rename the 'mode' option to
	'packet_mode'.

	* src/core/exmpp_tls.erl: Now interpret options and run the
	corresponding port driver commands.

	* c_src/exmpp_tls.h, c_src/exmpp_tls.c, c_src/Makefile.am: Move common
	TLS constants and functions to a separate C file.

	* c_src/exmpp_tls_openssl.c: Add support for options. Fix a bug with
	the COMMAND_SET_PEER_VERIF command where expected_id was always set to
	the empty string when the caller specified a boolean instead. Add
	preliminary support for certificate verification (WORK IN PROGRESS).
	For now, it understands the basic verification made by OpenSSL and
	check the expected_id against subjectAltName.dNSName (not exactly as
	specified in RFC 2818 though). It still lacks the check against the
	XMPP-specific subjectAltName extension and the commonName.

2008-05-22  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Import of the new compression layer.

	* configure.ac: Always check for Zlib, not only when the compat layer
	is enabled. Print a summary of supported engines for both TLS and
	compression.

	* src/core/exmpp_compress.erl, c_src/exmpp_compress_zlib.c,
	src/Makefile.am, src/Emakefile.in, c_src/Makefile.am,
	ebin/Makefile.am, ebin/exmpp.app.in, doc/Makefile.am: Add
	exmpp_compress and its associated port driver.

	* src/core/exmpp_tls.erl: Fixed some issues with documentation.

	* src/core/exmpp_tls.erl, src/core/exmpp_compress.erl: Fix start/0 and
	start_link/0 return values.

	* c_src/exmpp_compress_zlib.c: Free Z streams when the driver is
	stopped.

	* src/core/exmpp_sup.erl: Remove start/0 because supervisor:start/3
	never existed. Start exmpp_compress.

2008-05-21  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Import of the new TLS layer.

	* configure.ac: Always check for OpenSSL, not only when the compat
	layer is enabled.

	* src/core/exmpp_tls.erl, c_src/exmpp_tls_openssl.c, src/Makefile.am,
	src/Emakefile.in, c_src/Makefile.am, ebin/Makefile.am,
	ebin/exmpp.app.in, doc/Makefile.am: Add exmpp_tls and its associated
	port driver.

	* src/core/exmpp_tls.erl, c_src/exmpp_tls_openssl.c: Add
	controlling_process/2 and close/1 functions. Allow the underlying
	socket to return data as lists. Allow the caller to send data as list;
	the receive part is done but the option isn't available yet. Fix
	handshake for the client side. When the handshake fails, the port
	driver now returns the reason string provided by OpenSSL. Until a real
	verify_callback is made, any certificate is accepted.

	* src/core/exmpp_tls.erl: Add basic documentation. Fix $Id$ tag.
	(recv/3): Add real timeout support.

	* src/core/exmpp_sup.erl: Start exmpp_tls.

2008-05-21  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* doc/Makefile.am: Fixed distributed files list.

	* c_src/exmpp_expat.c, c_src/exmpp_stringprep.c: style(9).

	* src/core/exmpp_internals.erl (load_driver): Add a clause to allow
	the caller to specify the directories list where the driver should be
	found.

2008-05-20  Pablo Polvorin <pablo.polvorin@process-one.net>

	* src/network/exmpp_ssl.erl: Fix compatibility bug with old OTP
	versions that doesn't allow the reuseaddr option in ssl sockets.

	* src/network/exmpp_ssl.erl: Refactor the code, using exmpp_tcp.erl as
	a model.

2008-05-13  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* c_src/exmpp_expat.c, c_src/Makefile.am, c_src/Makefile.unix,
	src/core/exmpp_xml.erl: Rename 'exmpp_expat_drv' to 'exmpp_expat'.

	* c_src/exmpp_stringprep.c, c_src/Makefile.am, c_src/Makefile.unix,
	src/core/exmpp_stringprep.erl: Rename 'exmpp_stringprep_drv' to
	'exmpp_stringprep'.

2008-05-07  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp.hrl: Add a macro to test IQ in guard expressions.
	Rename NS_JABBER_SESSION as NS_SESSION.

	* src/server/exmpp_server_binding.erl,
	src/server/exmpp_server_compression.erl,
	src/server/exmpp_server_legacy_auth.erl,
	src/server/exmpp_server_sasl.erl,
	src/server/exmpp_server_session.erl,
	src/server/exmpp_server_tls.erl: Use 'receiving entity' instead of
	'server'. Replace references to exmpp_server_stream with
	exmpp_stream.

	* src/server/exmpp_client_binding.erl,
	src/client/exmpp_client_compression.erl,
	src/client/exmpp_client_legacy_auth.erl,
	src/server/exmpp_client_sasl.erl,
	src/server/exmpp_client_session.erl,
	src/server/exmpp_client_tls.erl: Use 'initiating entity' instead of
	'client'.

	* src/client/exmpp_client_binding.erl,
	src/server/exmpp_server_compression.erl,
	src/client/exmpp_client_compression.erl: Fix exceptions documention.

	* src/client/exmpp_client_compression.erl,
	src/server/exmpp_server_sasl.erl: Avoid list concatenation when it's
	possible.

	* src/server/exmpp_server_binding.erl,
	src/server/exmpp_server_legacy_auth.erl,
	src/client/exmpp_client_legacy_auth.erl: Update documentation. Use the
	new IS_IQ macro.

	* src/server/exmpp_server_sasl.erl, src/server/exmpp_client_sasl.erl,
	src/server/exmpp_server_session.erl,
	src/server/exmpp_client_session.erl, src/server/exmpp_server_tls.erl,
	src/client/exmpp_client_tls.erl: Use exceptions for error handling.
	Add basic documentation.

	* src/server/exmpp_server_sasl.erl (failure): Rewrite error creation.
	(next_step): Change {auth, Mech} by {auth, Mech, none} so that the
	'auth' tuple has always the same size.

	* src/server/exmpp_server_binding.erl,
	src/client/exmpp_client_binding.erl,
	src/server/exmpp_server_session.erl,
	src/client/exmpp_client_session.erl: Use exmpp_iq instead of
	exmpp_xml.

	* src/client/exmpp_client_binding.erl (announced_support): Fix a bug
	where true was returned when the support was not announced.

	* src/server/exmpp_server_session.erl: Add a function to report an
	error.

	* src/client/exmpp_client_session.erl: Add a function to check if the
	feature was announced. Use exmpp_internals:random_id/1 for IDs.

	* src/core/exmpp_iq.erl: Add a function iq_iq/1, mostly to demonstrate
	the new IS_IQ macro.

2008-04-18  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_error.erl, src/core/exmpp_stanza.erl,
	src/core/exmpp_iq.erl, src/core/exmpp_stream.erl,
	src/server/exmpp_server_binding.erl,
	src/server/exmpp_server_legacy_auth.erl,
	src/client/exmpp_client_binding.erl,
	src/client/exmpp_client_legacy_auth.erl, src/Makefile.am,
	src/Emakefile.in, ebin/Makefile.am, ebin/exmpp.app.in,
	doc/Makefile.am: Rename exmpp_error to exmpp_stanza.

	* src/core/exmpp_jlib.erl, src/Makefile.am, src/Emakefile.in,
	ebin/Makefile.am, ebin/exmpp.app.in, doc/Makefile.am: Remove
	exmpp_jlib.

	* src/core/exmpp_internals.erl: Add functions to generale a random ID.

	* src/core/exmpp_stream.erl, src/core/exmpp_stanza.erl,
	src/client/exmpp_client_binding.erl: Use exmpp_internals for random
	ID.

	* src/core/exmpp_iq.erl: Add functions to access request and result
	contained in an IQ.

	* src/server/exmpp_server_legacy_auth.erl,
	src/client/exmpp_client_legacy_auth.erl: Modify and add functions to
	better handle legacy authentication. It's now possible to tell which
	fields to propose from the server side and get credentials from the
	stanza sent by the client. From the client side, the password stanza
	is built based on the fields supported by the server.

	* testsuite/check_legacy_auth.erl: Update testsuite for
	exmpp_server_legacy_auth and exmpp_client_legacy_auth.

2008-04-17  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Second round of commits for the Big Cleanup.

	* src/server/exmpp_server_binding.erl,
	src/client/exmpp_client_binding.erl,
	src/server/exmpp_server_compression.erl,
	src/client/exmpp_client_compression.erl,
	src/server/exmpp_server_legacy_auth.erl,
	src/client/exmpp_client_legacy_auth.erl: Update to use the new
	modules/structures. Add basic documentation. Style.

	* testsuite/check_legacy_auth.erl: Update testsuite for
	exmpp_server_legacy_auth and exmpp_client_legacy_auth.

2008-04-17  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	First round of commits for the Big Cleanup.

	* include/exmpp.hrl, c_src/exmpp_expat_drv.c: Add a "default_ns"
	member to #xmlnselement; we keep the default namespace in it,
	regardless of the namespace of the current element. Style.

	* c_src/exmpp_stringprep_drv.c: Add a command to return the port
	driver $Revision$. Style.

	* src/core/exmpp_internals.erl, src/core/exmpp_stringprep.erl: Use
	exceptions for error handling. Add basic documentation.

	* src/core/exmpp_xml.erl: Use exceptions for error handling. Use
	exmpp_internals for port driver load/unload. Add function clauses for
	accept "undefined" as an XML element. Change several functions to
	return "undefined" instead of an empty string. Use the new
	"default_ns" member during serialization. Update documentation.
	Style.

	* testsuite/check_xml_parser.erl,
	testsuite/check_xml_attribute_handlers.erl,
	testsuite/check_xml_element_handlers.erl,
	testsuite/check_xml_cdata_handlers.erl, testsuite/check_xml_path.erl,
	testsuite/check_xml_converters.erl: Update testsuite for exmpp_xml.

	* src/core/exmpp_jid.erl: Use exceptions for error handling. Add basic
	documentation. Style.

	* testsuite/check_jid.erl: Update testsuite for exmpp_jid.

	* src/core/exmpp_xmlstream.erl: Use exceptions for error handling.
	Style.

	* testsuite/check_xmlstream.erl: Update testsuite for exmpp_xmlstream.

	* src/core/exmpp_stream.erl: Now, everything at the stream-level is
	handled here. exmpp_client_stream and exmpp_server_stream should be
	deleted as soon as the functions to manipulate features have moved
	here. API of existing functions has changed. Use exceptions for error
	handling.

	* testsuite/check_stream.erl: Update testsuite for exmpp_stream.

	* src/core/exmpp_error.erl: Everything at the stanza-level is handled
	here. This module will be renamed as exmpp_stanza soon. Add basic
	documentation.

	* src/core/exmpp.erl, src/core/exmpp_sup.erl: Add basic documentation.
	Style.

	* src/core/exmpp_iq.erl, src/Emakefile.in, src/Makefile.am,
	ebin/Makefile.am, ebin/exmpp.app.in, doc/Makefile.am: Add exmpp_iq, a
	new module to provide functions specific to IQs.

	* testsuite/testsuite.erl: Be verbose when Result and Ref doesn't
	match. Style.

	* src/core/exmpp_stream.erl, src/server/exmpp_server_stream.erl,
	src/client/exmpp_client_stream.erl, src/Makefile.am, src/Emakefile.in,
	ebin/Makefile.am, ebin/exmpp.app.in, doc/Makefile.am: Move the
	exmpp_server_stream:features/1 to exmpp_stream and remove
	exmpp_server_stream and exmpp_client_stream.

2008-04-17  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* doc/Makefile.am: Wildcards are voluntarily not supported by
	automake(1). To fix the build, we list explicitly every HTML files.
	The "-i ''" argument of BSD sed still doesn't behave like GNU sed. To
	fix this, we use an backup extension ("-i.bak") and remove the
	backup.

	* testsuite/test.sh: Fix sed(1) usage as above.

2008-04-16  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* README: Fix autotools usage.

	* testsuite/test.sh, testsuite/check_coverity.erl,
	testsuite/Makefile.am: Build an index for code coverage reports.

	* doc/Makefile.am: Replace ISO-8859-1-encoded '©' by an HTML entity.

2008-04-03  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/Makefile.am: Update modules list. Replace erl -make by a small
	Erlang code snippet: if a module doesn't compile, the make process
	will abort.

	* src/Emakefile.in: Update modules list.

	* ebin/Makefile.am: Update modules list. Install examples in a
	separate directory (examples/ebin instead of ebin) to avoid namespace
	pollution.

	* doc/Makefile.am: Add the examples to the dependencies. Fix the
	sed(1) call; with BSD sed, the -i'' argument wasn't using a
	zero-length extension but the next argument as the backup extension.
	Fix the distributed files list.

	* src/network/exmpp_ssl.erl, src/network/exmpp_session.erl,
	src/examples/echo_client.erl: Fix warning with unused variables. Three
	warnings remain in exmpp_session but this requires more work.

	* src/examples/echo_client.erl: Fix a malformed documentation. Fix
	includes path.

	* configure.ac: Remove the EXMPP_CONFIGURE_ARGS variable because it's
	broken and unsued. Replace AC_PROG_CC with AC_PROG_CC_STDC and trust
	autoconf(1) by not saving CFLAGS before. Remove -Wall and -Werror from
	CFLAGS; they are both added later. Remove AC_HEADER_STDC and
	AC_HEADER_MAJOR which are obsolete now. With --enable-debug, we don't
	add -g because AC_PROG_CC_STDC already does it. Correctly use
	--enable-* for features (documentation and workarounds), instead of
	--with-*. Rewrite Erlang paths and applications detection to correctly
	handle $ERL and $ERLC. Renamed the 'broken-erl_ddll' feature to
	'erl_ddll-workaround'. Add a new 'http_base_64' detection feature,
	because this module was removed from Erlang starting with R12B-0.

	* src/core/exmpp_internals.erl, src/server/exmpp_server_sasl.erl,
	src/client/exmpp_client_sasl.erl: Starting with Erlang R12B-0, the
	http_base_64 module was removed, replaced by base64 from stdlib
	1.14.4. When ENABLE_HTTP_BASE_64 if defined, we try to use
	http_base_64 and fallback to base64 is necessary. If it's not defined,
	we use only base64.

	* ac-aux: Remove this directory. It's created and filled by
	autoreconf(1) and doesn't belong to the exmpp repository.

	* ebin/exmpp.app.in: Update modules list.

	* ebin/exmpp.appup.in: Remove upgrade/downgrade instructions because
	they are outdated.

	* src/core/exmpp_internals.erl: Use base64:*code_to_string/1, because
	http_base_64 was returning string too.

2008-02-11  Mickael Remond  <mremond@process-one.net>

	* src/network/exmpp_session.erl: API improvement: we can send and
	receive packet right after connection. Developper can thus write
	their own authentication.
	* src/client/exmpp_client_register.erl: Added unregister packets
	creation.

	* src/core/exmpp_xml.erl: Improved API: We can now register a user
	even if we have not set the authentication parameters
	* src/examples/echo_client.erl: Minor typo in comment

2008-02-10  Mickael Remond  <mremond@process-one.net>

	* src/core/exmpp_error.erl: Improved exceptions
	* src/core/exmpp_internals.erl: Likewise
	* src/core/exmpp_xml.erl: Likewise
	* src/network/exmpp_session.erl: Likewise

	* src/network/exmpp_session.erl: Fixed exmpp session start in
	debug mode
	
	* src/core/exmpp_xml.erl: Beautify code
	
2008-02-09  Mickael Remond  <mremond@process-one.net>

	* src/network/exmpp_session.erl: We can now open the stream before
	defining authentication method. In this case, we need to pass an
	extra domain parameter.
	* src/core/exmpp_jid.erl: Fixed indentation.
	* src/core/exmpp_stringprep.erl: Fixed indentation.

2008-01-27  Mickael Remond  <mremond@process-one.net>

	* src/network/exmpp_session.erl: Now forward IQ packet to client
	session (Thanks to Will Glozer).

	* src/network/exmpp_session.erl: Support session stop (Thanks to Will
	Glozer).

2008-01-16  Mickael Remond  <mremond@process-one.net>

	* src/network/exmpp_ssl.erl: SSL client connection support (Thanks
	to Wil Glozer)
	* src/Emakefile.in: Likewise
	* src/Makefile.am: Likewise
	* exmpp/src/network/exmpp_session.erl: Likewise
	* exmpp/ebin/Makefile.am: Likewise
	
	* exmpp/configure.ac: Clean-up compilation process (Thanks to Will
	Glozer)
	* exmpp/include/exmpp.hrl: Likewise
	* exmpp/src/Makefile.am: Likewise
	* exmpp/ebin/Makefile.am: Likewise
	* exmpp/ac-aux/depcomp: Likewise
	* exmpp/ac-aux/missing: Likewise
	* exmpp/ac-aux/config.guess: Likewise
	* exmpp/ac-aux/config.sub: Likewise
	* exmpp/ac-aux/ltmain.sh: Likewise
	* exmpp/ac-aux/install-sh: Likewise	

2007-07-02  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/Makefile.am, src/Makefile.am, src/Emakefile.in,
	ebin/Makefile.am: Updated Makefiles to include the new modules.

	* ebin/exmpp.app.in: The modules list wasn't up-to-date; it's now
	fixed.

2007-07-01  Christophe Romain  <christophe.romain@process-one.net>

	* include/xmpp.hrl, src/network/exmpp_callbacks.erl,
	src/network/exmpp_tcp.erl: Add network modules for direct client use.

2007-07-01  Mickael Remond  <mremond@process-one.net>

	* src/core/exmpp_jid.erl: Make jid can generate random resource when
	asked. A new is_jid function has been added.

2007-06-26  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Branch 0.7.

2007-06-20  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* c_src/Makefile.am: Moved some targets around to reorder them more
	logically.

	* Makefile.unix, c_src/Makefile.unix, src/Makefile.unix,
	ebin/Makefile.unix: Added Makefiles to provide an alternate build
	procedure. It's intended for Unix plateforms where the autotools are
	not as common as under Linux/*BSD. Note that this method doesn't have
	any option to disable the compatibility layer or to build the
	documentation yet. They require GNU make(1).

2007-06-19  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/server/exmpp_server_sasl.erl (next_step),
	src/server/exmpp_server_session.erl (want_establishment),
	src/server/exmpp_server_binding.erl (wished_resource): Return an error
	if the given stanza is unexpected. If the argument isn't an
	#xmlnselement{}, it still raises a function clause EXIT.

	* src/server/exmpp_server_binding.erl (error): Add the
	`not-authorized' case.

	* src/core/exmpp_stream.erl, src/server/exmpp_server_stream.erl,
	src/client/exmpp_client_stream.erl: Add helpers to access common
	attributes.

	* src/core/exmpp_xml.erl: Add functions to prepend one or more
	children to a given element's children.

	* m4/ax_compare_version.m4: New M4 macro to compare version numbers in
	a configure script.

	* configure.ac: Updated the required autoconf version to 2.60 (for
	official Erlang support). Removed directives which were never used
	and already commented out. Check Erlang kernel's version to
	automatically enable or disable erl_ddll workaround. Check for sed(1).

	* doc/Makefile.am: Documentation is now rebuilt only if one of the
	source files is updated. Add `erlang.png' to the CLEANFILES. Add the
	correct encoding to every HTML documents with sed(1).

2007-05-15  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/server/exmpp_server_compression.erl (methods_list2),
	src/server/exmpp_server_sasl.erl (mechanisms_list2): Verify if the
	given argument is an authentic string.

	* src/core/exmpp_sup.erl: Do not use supervisor:start/3 because it
	never existed. Spotted by Dialyzer.

2007-05-04  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_xml.erl: Unlink port before stopping it. This
	prevents an 'EXIT' message sent to the port owner.

	* doc/overview.edoc: Nano update of the application overview.

2007-04-20  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* doc/Makefile.am: Fixed documentation build: the new sources layout
	broke it. Also add `make install' support.

2007-04-18  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp.hrl: Added resource binding namespace.

	* src/client/exmpp_client_binding.erl,
	src/server/exmpp_server_binding.erl: New modules to deal with Resource
	Binding.

	* src/client/exmpp_client_session.erl,
	src/server/exmpp_server_session.erl: New modules to deal with Session
	Establishment.

	* src/client/exmpp_client_tls.erl: Renamed a variable to be consistent
	with other modules.

	* src/Makefile.am, src/Emakefile.in, ebin/Makefile.am: Connected new
	modules to the build.

2007-04-12  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_stream.erl, src/client/exmpp_client_stream.erl,
	src/server/exmpp_server_stream.erl: Removed `stream_' prefix from all
	functions.

	* src/server/exmpp_server_stream.erl (features): New function to build
	a features announcement stanza.

	* testsuite/check_stream.erl, testsuite/check_legacy_auth.erl:
	Corrected a comment.

	* testsuite/check_stream.erl: Updated to use new function names in
	`exmpp_stream'.

	* src/client/exmpp_client_tls.erl, src/server/exmpp_server_tls.erl:
	New modules to deal with TLS negotiation.

	* src/client/exmpp_client_compression.erl,
	src/server/exmpp_server_compression.erl: New modules to deal with
	stream compression negotiation.

	* src/client/exmpp_client_sasl.erl, src/server/exmpp_server_sasl.erl:
	New modules to deal with SASL transport.

	* src/Makefile.am, src/Emakefile.in, ebin/Makefile.am: Connected all
	new modules to the build. Disconnected `exmpp_factory' for future
	removal.

	* src/core/exmpp_factory.erl: Removed because all code was moved to
	dedicated modules.

2007-04-11  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/core/exmpp_factory.erl, src/core/exmpp_stream.erl,
	src/client/exmpp_client_stream.erl,
	src/server/exmpp_server_stream.erl, src/Makefile.am, src/Emakefile.in,
	ebin/Makefile.am, testsuite/check_factory_stream.erl,
	testsuite/Makefile.am: Moved stream handling code to dedicated
	modules.

	* testsuite/check_factory_stream.erl, testsuite/check_stream.erl,
	testsuite/Makefile.am, testsuite/Emakefile.in: Renamed test for
	`exmpp_stream'.

	* src/core/exmpp_factory.erl, src/client/exmpp_client_legacy_auth.erl,
	src/server/exmpp_server_legacy_auth.erl, src/Makefile.am,
	src/Emakefile.in, ebin/Makefile.am,
	testsuite/check_factory_legacy_auth.erl: Moved legacy authentication
	handling to dedicated modules.

	* testsuite/check_factory_legacy_auth.erl,
	testsuite/check_legacy_auth.erl, testsuite/Makefile.am,
	testsuite/Emakefile.in: Renamed test for `exmpp_client_legacy_auth'
	and `exmpp_server_legacy_auth'.

2007-03-07  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/comp: Renamed `src/comp' to `src/compat'.

	* src/exmpp_factory.erl: Move to `src/core'; some code still needs to
	be moved in appropriate modules in `src/server' or `src/client'.

	* src/Makefile.am, src/Emakefile.in, ebin/Makefile.am,
	ebin/exmpp.app.in, testsuite/check_coverity.erl: Updates to take into
	account new `src' layout.

2007-03-06  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/exmpp_xml.erl: Restore DRIVER_NAME value. Style.
	(get_cdata): Changed return value of the new function clause to the
	`false', like related functions.

2007-03-06  Christophe Romain  <christophe.romain@process-one.net>

	* src/exmpp_factory.erl: Add functions to delete a pubsub node.

	* src/*.erl: Reorganize source files in separate subdirectories.

2007-03-05  Mickaël Rémond  <mickael.remond@process-one.net>

	* src/exmpp_xml.erl (get_cdata): Handle a false value. This clause
	make it possible to write code like:
	exmpp_xml:get_cdata(exmpp_xml:get_element_by_name(XML_El, body))

2007-03-04  Mickaël Rémond  <mickael.remond@process-one.net>

	* src/exmpp_xml.erl: Added get_element_by_ns/2. This function is
	useful to extract XMPP error codes (to make sure you are getting the
	correct tag).

2007-03-02  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* configure.ac: Remove checks for `kernel' and `stdlib' Erlang
	applications. They're not used at build time.

	* testsuite/test.sh: Fixed IFS variable because the TESTS variable
	contains Tab characters.

	* c_src/expat_drv.c, c_src/exmpp_expat_drv.c, c_src/Makefile.am,
	src/exmpp_xml.erl: Renamed Expat port driver to have the `exmpp_'
	prefix.

2007-03-01  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/exmpp_internals.erl (driver_dirs): Revised port drivers search
	path. This allows us to remove priv/lib/Makefile hack needed to run
	the package testsuite.

	* src/exmpp_xml.erl: Use exmpp_internals to load/unload its port
	driver.

	* configure.ac, Makefile.am: Disconnect priv directory from the build,
	prior to its removal.

	* priv/: Removed directory, because it's not needed anymore by the
	testsuite.

	* testsuite/Makefile.am: Do not run `check_xml_parser' and
	`check_xmlstream' tests if Expat support isn't present.

2007-02-28  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/exmpp_internals.erl, src/exmpp_xml.erl: To avoid conflicts
	between an installed exmpp and a fresh build during testsuite runs,
	port drivers are first checked in working subdirectories. However,
	this is not done in modules from the compat layer (ejabberd_zlib,
	iconv and tls).

	* m4/zlib.m4: New M4 to check Zlib presence.

	* m4/openssl.m4: New M4 to check OpenSSL presence.

	* m4/expat.m4: Renamed AM_EXPAT to EXMPP_EXPAT to avoid Automake AM
	namespace pollution.

	* m4/iconv.m4, m4/lib-link.m4, m4/lib-prefix.m4, m4/lib-ld.m4: Rewrote
	iconv.m4 because the one from gettext seems broken with
	cross-compilation and win32 environment.

	* configure.ac: Add support for cross-compilation and win32 platform.
	Updated checks for Expat and libiconv. Added checks for OpenSSL.

	* c_src/Makefile.am: Added more AM_CONDITIONNAL's to enable/disable
	port drivers one by one. Fixed `tls_drv' dependencies. Added support
	for win32.

2007-02-21  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/exmpp_jid.erl: Add support for JID comparison.

	* testsuite/check_jid.erl: Add JID comparison testsuite.

	* include/exmpp.hrl, src/exmpp_jid.erl, src/jlib.erl,
	testsuite/check_jid.erl: Fields of the #jid record were renamed to use
	the names found in RFC 3920. THIS CHANGE BREAKS API (not ABI).

	* ebin/Makefile.am: Because of a misuse of Automake conditionnals, the
	`beam_DATA' variable was not correct and the compat modules were never
	installed nor cleaned.

2007-02-20  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/exmpp_stringprep.erl: Catch up with original `stringprep' level
	of feature: a function to lowercase strings was added. Add functions
	if an identifier is a valid node, name or resource.

	* src/stringprep.erl: `stringprep' is now a simple frontend to
	`exmpp_stringprep'.

	* src/exmpp_jid.erl: Identifiers length are now checked.

	* testsuite/check_jid.erl: Complete testsuite with length checks.

	* src/exmpp_jlib.erl: Drop JID handling functions.

	* src/jlib.erl: Use `exmpp_jid' and `exmpp_stringprep' to treat JIDs.

	* configure.ac: Fixed a bug with --enable-debug option handling.
	Disable documentation by default, because `xmerl' is broken in Erlang
	R11B-3.

	* c_src/iconv_erl.c: Fixed a warning with iconv(3): on some platforms,
	`inbuf' is qualified by `const'. The configure script will check the
	prototype for us.

2007-02-19  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/exmpp_jid.erl: Reworked JID parsing to handle more error cases.
	Now, the resource for a bare JID is set to `undefined', not the empty
	string.

	* testsuite/check_jid.erl: The testsuite for the current state of
	`exmpp_jid' is complete.

2007-02-15  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/exmpp_stringprep.erl: New frontend for the exmpp_stringprep_drv
	port driver.

	* src/exmpp_internals.erl: New module which provide low-level
	functions for port drivers handling.

	* src/exmpp_sup.erl: Supervisor who is responsible for
	exmpp_stringprep startup.

	* src/exmpp.erl, ebin/exmpp.app.in: This module uses the `application'
	behaviour now. It starts `exmpp_sup'.

	* src/exmpp_jid.erl: New module which provides functions to manipulate
	JIDs.

	* src/Emakefile.in, src/Makefile.am, ebin/Makefile.am: Link each new
	modules to the build.

	* testsuite/check_jid.erl, testsuite/Emakefile.in,
	testsuite/Makefile.am: Add a first testsuite for `exmpp_jid'.

2007-02-06  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* c_src/uni_data.c, c_src/uni_norm.c, c_src/stringprep_uni_data.h,
	c_src/stringprep_uni_norm.h: Renamed as real headers.

	* c_src/stringprep_drv.c: Internal name of the driver changed to
	`exmpp_stringprep_erl'.

	* c_src/exmpp_stringprep_drv.c, c_src/exmpp_stringprep_drv.c,
	c_src/Makefile.am, src/stringprep.erl, priv/lib/Makefile.am: Prefixed
	`stringprep_drv' with `exmpp_' to avoid conflicts with ejabberd's own
	stringprep_drv. This permits exmpp to coexist with ejabberd.

2007-01-09  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* configure.ac: Next branch will be 0.7.

2007-01-09  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* configure.ac: Fixed the name of a variable.

2007-01-04  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* configure.ac: Head is now the future 0.6 branch. Dropped
	`EXMPP_BUILD_ID'. Debug is disabled by default when
	`EXMPP_RELEASE_DATE' is set and enabled otherwise. Comments translated
	in english.

	* include/exmpp.hrl: Add `jabber:iq:privacy', `jabber:iq:roster' and
	`urn:ietf:params:xml:ns:xmpp-session' namespaces.

	* doc/Makefile.am: Clean stylesheet.css if it was copied at compile
	time.

	* src/exmpp_factory.erl: Add functions to make common pubsub stanzas.

	* src/exmpp_jlib.erl: Add functions to convert #jid{} to string and
	the other way around. Style.

	* testsuite/test.sh: Fixed portability issues with sed(1) and head(1).

	* c_src/xmpp_ns.h.in, c_src/xmpp_attrs.h.in, c_src/xmpp_names.h.in:
	Added pubsub-related namespaces, element names and attribute names.

	* c_src/Makefile.am: Fixed CPPFLAGS for expat_drv (EXPAT_CPPFLAS was
	missing).

2006-10-30  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* priv/lib/Makefile.am: Copies of stringprep_drv.so,
	tls_drv.so and iconv_erl.so are useless, because they're not tested by
	the current testsuite.

	* include/exmpp.hrl: Corrections in comments.

	* src/exmpp_jlib.erl, src/jlib.erl, src/Emakefile.ini,
	src/Makefile.am: As we did with `exmpp_xml' and `xml', we split
	`exmpp_jlib' in `exmpp_jlib' and `jlib' to separate the old code with
	the new one. Because this module didn't received a lot of
	modifications and testing, we took this opportunity to import the last
	version of `jlib' from today's ejabberd repository.

	* src/exmpp_xml.erl, configure.ac: Add a compile-time flag to enable a
	workaround for `erl_ddll' reference count bug.

	* configure.ac, c_src/Makefile.am, ebin/Makefile.am: Add a flag to
	disable the compatibility modules.

	* ebin/exmpp.app.in, ebin/exmpp.appup.in: Application file and upgrade
	file update.

	* configure.ac, src/Emakefile.in, ebin/exmpp.app.in: If compatibility
	modules are disabled, don't build/list them.

2006-10-12  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/exmpp_xml.erl (start_parser): Unload driver if an error occurs
	with options handling.
	(stop_parser): Don't catch exceptions with port_close/1; the caller is
	responsible for catching them if he wants.

2006-10-05  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* configure.ac: Préparation de la release 0.5.3.

	* ebin/exmpp.appup.in: Instructions de mise à jour depuis la version
	0.5.2.

	* src/exmpp_xml.erl (stop_parser): Avant de décharger la librairie, on
	vérifie que port_close a fonctionné (en `catch'ant l'exception). Ça
	évite de trop décrémenter le comptage de référence sur la librairie.

2006-09-28  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* configure.ac: Préparation de la release 0.5.2.

	* c_src/expat_drv.c (current_tree_finished): Correction d'un autre
	leak du même type que celui du 2006-09-25.

	* ebin/exmpp.app.in: Utilisation de @VERSION@ au lieu de
	@PACKAGE_VERSION@ pour rester cohérent.

	* ebin/exmpp.appup.in: Utilisation de @VERSION@ au lieu d'une version
	en dur. Mise à jour pour prendre en compte une upgrade/downgrade entre
	la version 0.5.2 et la version 0.5.1.

2006-09-26  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/exmpp_xml.erl (reload_driver): Suppression de la fonction, on ne
	peut pas s'en servir en l'état.
	(stop_parser): Après le port_close/1, on décharge la librairie.

	* src/exmpp_factory.erl (legacy_auth_request_with_user): Nouvelle
	fonction pour préciser le nom d'utilisateur dans la requête
	d'authentification. Correction de l'exportation de la fonction.

2006-09-25  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* configure.ac: Préparation de la release 0.5.1.

	* c_src/expat_drv.c: Ajout d'une commande pour retourner la revision
	du fichier.
	(expat_drv_control): Correction d'un memory leak.

	* src/exmpp_xml.erl: Ajout d'une fonction pour récupérer la revision
	du port driver `expat_drv'.

	* configure.ac, ebin/exmpp.appup, ebin/Makefile.am: Ajout du fichier
	de mise à jour.

2006-09-11  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Release 0.5.0.

	* configure.ac: Mise à jour de la version.

2006-09-11  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* m4/expat.m4: Corrections de bug dans les flags passés au compilateur
	si l'utilisateur précise --with-expat=DIR.

2006-09-07  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* ebin/charon.app.in: On ajoute $Id$ pour l'id de l'application.

2006-09-04  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Release 0.4.7.

	* src/exmpp_factory.erl: Correction de la documentation.

	* src/exmpp_xml.erl (load_driver): Correction d'un bug avec le
	chargement de la librairie. En fait, il faut charger la librairie
	autant de fois que open_port est appelé car erl_ddll maintient un
	comptage de référence. C'est pour cette raison qu'avec les version
	précédentes de `exmpp_xml', tous les parsers instanciés étaient
	détruits avec le premier appel à `stop_parser'.

	* c_src/expat_drv.c (expat_drv_stop): Le `return' final est
	complètement inutile.
	(expat_drv_control): En cas de commande inconnue, on retourne `{error,
	badarg}' au lieu de `badarg'.

2006-08-31  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Release 0.4.6.

	* include/exmpp.hrl: Ajout du namespace utilisé pour les erreurs au
	niveau stream.

	* src/exmpp_factory.erl (stream_error): Nouvelle fonction pour générer
	les erreurs au niveau stream.

2006-08-29  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Release 0.4.5.

	* configure.ac: Ajout de flags de compilation Erlang pour avoir un
	maximum de warnings.

	* src/xml.erl: Correction de la documenation pour que les fonctions
	obsolètes pointent vers `exmpp_xml'.
	(get_cdata, remove_cdata): Rajout de deux fonctions qui avaient été
	supprimées avec la séparation `exmpp_xml'/`xml'.

	* src/exmpp_xml.erl: Correction de la documentation.
	(replace_child): Nouvelle fonction pour remplacer le fils d'un élément
	XML.
	(xmlnselement_to_xmlelement, xmlnsattributes_to_xmlattributes2):
	Correction de plusieurs warnings.

	* ebin/exmpp.app.in: Mise à jour de la liste des modules ; il manquait
	`xml'.

2006-08-16  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Release 0.4.4.

	* include/exmpp.hrl, src/exmpp_xml.erl (document_fragment_to_list):
	Support rudimentaire des Processing Instructions pour permettre à
	l'appelant de générer `<?xml version='1.0' ?>' par exemple.

	* include/exmpp.hrl: Ajout des namespaces pour les demandes de
	compression, de TLS et de SASL.

	* src/exmpp_factory.erl: Ajout de fonctions pour générer des stanzas
	de négociations de TLS et de la compression.

	* src/exmpp_xml.erl (xmlelement_to_xmlnselement,
	xmlelement_to_xmlnselement_and_ns_tables): Ajout de fonctions pour
	convertir les anciens tuples vers les nouveaux formats.
	(xmlnselement_to_xmlelement): Correction d'un bug où le cas d'un
	namespace sous forme de chaîne de caractères (au lieu d'atome) n'était
	pas géré.

	* src/exmpp.erl, src/iconv.erl, src/ejabberd_zlib.erl, src/tls.erl,
	src/exmpp_xml.erl, src/stringprep.erl: On supprime la fonction
	exmpp:app/0 qui n'a pas de sens et on utilise le nom `exmpp' en dur.
	Ça permet l'utilisation d'exmpp dans une application, c'est magique.

	* ebin/Makefile.am: Le fichier d'application `exmpp.app' n'était pas
	installé, c'est corrigé.

	* ebin/exmpp.app.in: Correction d'une erreur de syntaxe. Ajout des
	modules manquants à la liste.

2006-08-04  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Release 0.4.3.

	* src/ejabberd_zlib.erl, c_src/ejabberd_zlib_drv.c, configure.ac,
	src/Makefile.am, c_src/Makefile.am, ebin/Makefile.am: Import du module
	ejabberd_zlib d'ejabberd.

	* configure.ac: La gestion de relase empruntait encore le nom de
	libcalimero.

	* src/exmpp_xmlstream.erl: Corrections de la documentation.

	* testsuite/check_coverity.erl: On n'inclut pas exmpp.hrl.

	* testsuite/Makefile.am: style(9).

2006-07-19  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Release 0.4.2.

	* src/exmpp_xmlstream.erl: Correction de la documentation qui faisait
	encore référence à l'option `rootdepth' du parser XML (au lieu de
	`root_depth').
	(parse, process_elements, process_elements2, send_events): On gère un
	nouveau callback `none' qui indique que l'appeleur de parse/2 veut
	récupérer le résultat directement (au lieu de l'envoyer à un autre
	process/une autre fonction). La documentation est mise à jour en
	conséquence.

	* src/exmpp_xml.erl: New parser option `no_root_depth' to force the
	parser to make an xmlnselement() for each tag.
	(parser_document_fragment): New function to parse an incomplete
	document; this takes advantage of the new `no_root_depth' option.

	* testsuite/check_xmlstream.erl: Updated to test the `no_callback'
	callback.

	* testsuite/Makefile.am: Added check_xmlstrea.erl to the EXTRA_DIST
	list.

	* c_src/expat_drv.c: Updated to handle the new `no_root_depth' parser
	option.

2006-07-13  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Release 0.4.1.

	* src/exmpp_factory.erl: Wrote user guide.

	* src/exmpp_jlib.erl (exchange_attrs_from_and_to_in_list,
	rename_attr_to_to_from_in_list): Fixed a bug where those functions
	were still calling `exmpp_xml:set_attribute_from_list' which has been
	renamed since.

	* testsuite/test/sh: Small change on coverity reports stylesheet.

	* doc/stylesheet.css: Changed completly the documentation graphical
	aspect.

2006-07-12  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp.hrl: For #xmlstreamstart and #xmlstreamend record,
	members are now #xmlnselement, #xmlelement, #xmlnsendelement or
	#xmlendelement.

	* configure.ac: Completly remove compatibility layer options.

	* src/exmpp_xml.erl, src/xml.erl: Moved pathcomponentold()
	documentation stub to `xml'.

	* src/exmpp_xmlstream.erl: Updated #xmlstreamstart and #xmlstreamend
	usage (members have changed).
	(send_event/2): Callbacks of type `process' or `gen_fsm' won't return
	an error code, remove this support.

	* c_src/expat_drv.c (expat_drv_end_element): Support for prefix and
	name as atom was never implemented for end elements; it's now done.

	* testsuite/check_coverity.erl: Completly remove compatibility layer
	options.
	(print_coverage): Generate a plain text output, not an HTML one. Also,
	use real newline characters in display, because testsuite/test.sh was
	fixed.

	* testsuite/Emakefile.in, testsuite/Makefile.am,
	testsuite/check_xmlstream.erl: Added a new test for
	`exmpp_xmlstream'.

	* testsuite/test.sh: Fixed command execution to not strip newline
	characters. Special treatment for `check_coverity' output was thus
	removed. Added a small function to convert plain text files produced
	by `check_coverity' in HTML files.

	* testsuite/check_xml_parser.erl: Fixed a testcase, now that
	c_src/expat_drv.c handles end element correctly.

	* testsuite/testsuite.erl: Print error report with Erlang to have
	output wrapped correctly.

2006-07-11  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/exmpp_xml.erl, src/xml.erl, src/Makefile.am, src/Emakefile.in,
	ebin/Makefile.am: Moved compatibility layer from `exmpp_xml' to
	`xml'.

	* src/xml.erl (crypt/1): Updated to reflect the original behaviour
	with binaries (it returns a list).

	* src/exmpp_xml.erl (encode_entities/1): Small optimization with
	binaries (removed a binary_to_list/1).

	* testsuite/check_xml_converters.erl: Added tests for
	encode_enities/1 and clear_endelement_tuples/1.

2006-07-10  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	Release 0.4.0.

	* include/exmpp.hrl: Renamed `NS_XMPP_STANZA' to `NS_XMPP_STANZAS'.

	* src/exmpp_factory.erl: Typos.
	(legacy_auth_request/2, legacy_auth_password/4,
	legacy_auth_password_digest/4): New functions to allow the caller to
	provide its own id.
	(legacy_auth_password, legacy_auth_password_digest): Added the
	`type' attribute.
	(legacy_auth_success): Set the element's children to the empty string.
	Fixed the namespace.
	(legacy_auth_failure): Fixed the namespace.

	* src/exmpp_xml.erl: Use the ?NS_XML macro (defined in
	include/exmpp.hrl) instead of a hard-coded URL.

	* c_src/xmpp_names.h.in: Added the `jabber:iq:auth' namespace
	elements.

	* testsuite/check_factory_stream.erl: New testsuite for the module
	exmpp_factory, only for the <stream> handling part.

	* testsuite/check_factory_legacy_auth: New testsuite for the module
	exmpp_factory, only for the legacy auth part.

	* testsuite/check_xml_*.erl: Use the ?NS_XML macro (defined in
	include/exmpp.hrl) instead of a hard-coded URL.

	* doc/Makefile.am: Added files to CLEANFILES variable.

2006-07-10  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* include/exmpp.hrl: By default, element's children are now
	`undefined', not an empty list anymore.

	* src/exmpp_xmlstream.erl: style(9).

	* src/exmpp_jlib.erl: New helpers to handle common attribute
	operations. Almost every existing functions will be deprecated by new
	functions like those.

	* src/exmpp_xml.erl: Fixed some function names. Added functions
	`set_attributes/2', `append_children/2' and `set_children/2' to do
	massive modifications in one call. Added functions
	`has_attribute_in_list/2,3' and `has_attribute/2,3' to tests the
	existence of an attribute. Added `normalize_cdata_in_list/1' and
	`normalize_cdata/1' to clean character data. Added
	`set_cdata_in_list/2' and `set_cdata/2' to change character data.
	Updated documentation about the use of `undefined' for element's
	children. Fixed a few other syntax issues with the documentation.
	(parse_document): Simplified function clauses to avoid code
	duplication.
	(xmlnsattributes_to_xmlattributes2): Fixed a bug when an attribute
	namespace is `undefined'.
	(document_fragment_to_list): If element's children are `undefined', do
	not close the tag.

	* c_src/Makefile.am: Fixed EXTRA_DIST for contrib/.

	* c_src/xmpp_ns.h.in: New namespace: `jabber:iq:auth'.

	* c_src/expat_drc.c: By default, element's children are now
	`undefined', not an empty list anymore.

	* ebin/Makefile.am, src/Makefile.am, src/Emakefile.in,
	src/exmpp_factory.erl: New module; it provides a toolbox to build
	common stanzas.

	* testsuite/Makefile.am: Coverity check for `exmpp_factory'.

	* testsuite/check_xml_attribute_handlers.erl,
	testsuite/check_xml_element_handlers.erl,
	testsuite/check_xml_converters.erl, testsuite/check_xml_parser.erl,
	testsuite/check_xml_cdata_handlers.erl: Updated with new function
	names and new test cases.

	* configure.ac, Makefile.am, doc/Makefile.am: Build documentation.

	* configure.ac, src/exmpp_xml.erl: Don't use the WITH_DEPRECATED_API
	preprocessor flag to avoid headaches with edoc.

2006-07-04  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/exmpp_xml.erl, c_src/expat_drv.c: Before namespaces, element
	names and attributes names are encoded as atom(), they're now checked
	against a list of known values. If they're not recognized, they're
	encoded as string(). Those checks can be disabled at runtime.

	* src/exmpp_xml.erl (parse_document/1, parse_document/2): New
	functions to parse a document at once.

	* src/exmpp_xmlstream.erl (parse_element/1, parse_element/2): These
	functions now use exmpp_xml:parse_document().

	* c_src/xmpp_{ns,names,attrs}.h.in: New files that contains a list
	of known namespaces, element names and attributes names, respectively.

	* c_src/xmpp_{ns,names,attrs}.h.awk: Awk script to convert the lists
	to C headers.

2006-07-03  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* src/exmpp_xml.erl (start_parser/1, handle_options/2): Error sent
	back by the port driver were ignored, it's now corrected.

	* c_src/contrib/hashtable.h, c_src/contrib/hashtable_private.h,
	c_src/hashtable.c: Imported an hashtable implementation which is used
	by the Expat port driver.

	* c_src/Makefile.am: Add hashtable sources to the Expat port driver.

	* c_src/expat_drv.c: Namespace prefixes are now stored in an hash
	table and set correctly in xmlnselement tuples.
	(expat_drv_control): Fixed a bug where the return value of
	create_parser() was not checked correctly.

	* testsuite/check_xml_parser.erl: Updated to handle namespace prefix
	support in the port driver. Also simplified each test cases.

2006-06-29  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	* configure.ac: Fixed a bug with $EMKOPTS handling.
	Removed two debugging messages. Fixed a typo with `debug_info'.

	* src/exmpp_xml.erl: The function get_path_s/2 wasn't exported; also
	it now handles old path component format.
	(remove_attribute_from_list): Rewritten this completly broken
	function.
	(xmlnselement_to_xmlelement): Now handle properly default and prefixed
	namespaces for elements and attributes.
	(xmlnselement_to_xmlelement): Support for name as atom() was not
	present in the old format, so convert them as string. Fixed a bug when
	an element doesn't have any namespace.
	(xmlnsattributes_to_xmlattributes2): Support for name as atom() was
	not present in the old format, so convert them as string.

	* src/iconv.erl, src/stringprep.erl: Fixed Erlang warnings.

	* testsuite/: More complete testsuite, with coverage checking.

	* testsuite/check_xml_converters.erl: Renamed from
	check_xml_serializer.erl to add other tests than just
	serialization.

	* ebin/Makefile.am, testsuite/Makefile.am: Every built files were not
	cleaned properly; fixed.

2006-06-28  Jean-Sébastien Pédron  <js.pedron@meetic-corp.com>

	The whole project uses the Autotools now.

	* include/exmpp.hrl: Add a prefix member to xmlnselement record. Add
	an xmlattr record to handle attribute (with namespace support).

	* src/exmpp_xml.erl: New API (more consistent) with better namespace
	support (even for attributes). There's a compatibility layer for the
	old API, which can be enabled by defining WITH_DEPRECATED_API at
	compile time.

	* c_src/expat_drv.c: Improve namespace support, especially for
	attributes. Add an option to put element and attribute name as
	atom().

	* c_src/tls_drv.c (tls_drv_control): Fixed a warning about different
	types in an affectation.

	* testsuite/: Add a testsuite.
