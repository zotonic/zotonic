<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Module z_session_page</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module z_session_page</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>Page session for interaction with the page displayed on the user agent.
<p>Copyright © 2009 Marc Worrell</p>

<p><b>Behaviours:</b> <a href="gen_server.html"><tt>gen_server</tt></a>.</p>
<p><b>Authors:</b> Marc Worrell (<a href="mailto:marc@worrell.nl"><tt>marc@worrell.nl</tt></a>).</p>

<h2><a name="description">Description</a></h2>Page session for interaction with the page displayed on the user agent. Support for comet polls and websocket.
       The page session is the switchboard for getting data pushed to the user agent.  All queued requests
       can be sent via the current request being handled, via a comet poll or a websocket connection.
<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#add_script-1">add_script/1</a></td><td>Split the scripts from the context and add the scripts to the page.</td></tr>
<tr><td valign="top"><a href="#add_script-2">add_script/2</a></td><td>Send a script to the user agent, will be queued and send when the comet process attaches.</td></tr>
<tr><td valign="top"><a href="#append-3">append/3</a></td><td></td></tr>
<tr><td valign="top"><a href="#check_timeout-1">check_timeout/1</a></td><td>Kill this page when timeout has been reached.</td></tr>
<tr><td valign="top"><a href="#code_change-3">code_change/3</a></td><td>Convert process state when code is changed.</td></tr>
<tr><td valign="top"><a href="#comet_attach-2">comet_attach/2</a></td><td>Attach the comet request process to the page session, enabling sending scripts to the user agent.</td></tr>
<tr><td valign="top"><a href="#comet_detach-1">comet_detach/1</a></td><td>Called when the comet request process closes, we will need to wait for the next connection.</td></tr>
<tr><td valign="top"><a href="#get-2">get/2</a></td><td></td></tr>
<tr><td valign="top"><a href="#get_attach_state-1">get_attach_state/1</a></td><td></td></tr>
<tr><td valign="top"><a href="#get_scripts-1">get_scripts/1</a></td><td>Called by the comet process or the page request to fetch any outstanding scripts.</td></tr>
<tr><td valign="top"><a href="#handle_call-3">handle_call/3</a></td><td>Handling call messages.</td></tr>
<tr><td valign="top"><a href="#handle_cast-2">handle_cast/2</a></td><td></td></tr>
<tr><td valign="top"><a href="#handle_info-2">handle_info/2</a></td><td></td></tr>
<tr><td valign="top"><a href="#incr-3">incr/3</a></td><td></td></tr>
<tr><td valign="top"><a href="#init-1">init/1</a></td><td>Initiates the server, initialises the pid lookup dicts.</td></tr>
<tr><td valign="top"><a href="#ping-1">ping/1</a></td><td>Receive a ping, makes sure that we stay alive.</td></tr>
<tr><td valign="top"><a href="#session_pid-1">session_pid/1</a></td><td></td></tr>
<tr><td valign="top"><a href="#set-3">set/3</a></td><td></td></tr>
<tr><td valign="top"><a href="#spawn_link-4">spawn_link/4</a></td><td>Spawn a new process, linked to the page pid.</td></tr>
<tr><td valign="top"><a href="#start_link-0">start_link/0</a></td><td>Starts the person manager server.</td></tr>
<tr><td valign="top"><a href="#start_link-1">start_link/1</a></td><td></td></tr>
<tr><td valign="top"><a href="#stop-1">stop/1</a></td><td></td></tr>
<tr><td valign="top"><a href="#terminate-2">terminate/2</a></td><td>This function is called by a gen_server when it is about to
  terminate.</td></tr>
<tr><td valign="top"><a href="#websocket_attach-2">websocket_attach/2</a></td><td>Attach the websocket request process to the page session, enabling sending scripts to the user agent.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="add_script-1">add_script/1</a></h3>
<div class="spec">
<p><tt>add_script(Context) -&gt; any()</tt></p>
</div><p>Split the scripts from the context and add the scripts to the page.</p>

<h3 class="function"><a name="add_script-2">add_script/2</a></h3>
<div class="spec">
<p><tt>add_script(Script, Context) -&gt; any()</tt></p>
</div><p>Send a script to the user agent, will be queued and send when the comet process attaches</p>

<h3 class="function"><a name="append-3">append/3</a></h3>
<div class="spec">
<p><tt>append(Key, Value, Context) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="check_timeout-1">check_timeout/1</a></h3>
<div class="spec">
<p><tt>check_timeout(Pid) -&gt; any()</tt></p>
</div><p>Kill this page when timeout has been reached</p>

<h3 class="function"><a name="code_change-3">code_change/3</a></h3>
<div class="spec">
<p><tt>code_change(OldVsn, State, Extra) -&gt; {ok, NewState}</tt><br></p>
</div><p>Convert process state when code is changed</p>

<h3 class="function"><a name="comet_attach-2">comet_attach/2</a></h3>
<div class="spec">
<p><tt>comet_attach(CometPid, Pid) -&gt; any()</tt></p>
</div><p>Attach the comet request process to the page session, enabling sending scripts to the user agent</p>

<h3 class="function"><a name="comet_detach-1">comet_detach/1</a></h3>
<div class="spec">
<p><tt>comet_detach(Pid) -&gt; any()</tt></p>
</div><p>Called when the comet request process closes, we will need to wait for the next connection</p>

<h3 class="function"><a name="get-2">get/2</a></h3>
<div class="spec">
<p><tt>get(Key, Context) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="get_attach_state-1">get_attach_state/1</a></h3>
<div class="spec">
<p><tt>get_attach_state(Pid) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="get_scripts-1">get_scripts/1</a></h3>
<div class="spec">
<p><tt>get_scripts(Pid) -&gt; any()</tt></p>
</div><p>Called by the comet process or the page request to fetch any outstanding scripts</p>

<h3 class="function"><a name="handle_call-3">handle_call/3</a></h3>
<div class="spec">
<p><tt>handle_call(Message::Request, From, State) -&gt; {reply, Reply, State} | {reply, Reply, State, Timeout} | {noreply, State} | {noreply, State, Timeout} | {stop, Reason, Reply, State} | {stop, Reason, State}</tt><br></p>
</div><p>Handling call messages</p>

<h3 class="function"><a name="handle_cast-2">handle_cast/2</a></h3>
<div class="spec">
<p><tt>handle_cast(Message::Msg, State) -&gt; {noreply, State} | {noreply, State, Timeout} | {stop, Reason, State}</tt><br></p>
</div>

<h3 class="function"><a name="handle_info-2">handle_info/2</a></h3>
<div class="spec">
<p><tt>handle_info(X1::Info, State) -&gt; {noreply, State} | {noreply, State, Timeout} | {stop, Reason, State}</tt><br></p>
</div>

<h3 class="function"><a name="incr-3">incr/3</a></h3>
<div class="spec">
<p><tt>incr(Key, Value, Context) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="init-1">init/1</a></h3>
<div class="spec">
<p><tt>init(Args) -&gt; {ok, State} | {ok, State, Timeout} | ignore | {stop, Reason}</tt><br></p>
</div><p>Initiates the server, initialises the pid lookup dicts</p>

<h3 class="function"><a name="ping-1">ping/1</a></h3>
<div class="spec">
<p><tt>ping(Pid) -&gt; any()</tt></p>
</div><p>Receive a ping, makes sure that we stay alive</p>

<h3 class="function"><a name="session_pid-1">session_pid/1</a></h3>
<div class="spec">
<p><tt>session_pid(Pid) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="set-3">set/3</a></h3>
<div class="spec">
<p><tt>set(Key, Value, Context) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="spawn_link-4">spawn_link/4</a></h3>
<div class="spec">
<p><tt>spawn_link(Module, Func, Args, Context) -&gt; any()</tt></p>
</div><p>Spawn a new process, linked to the page pid</p>

<h3 class="function"><a name="start_link-0">start_link/0</a></h3>
<div class="spec">
<p><tt>start_link() -&gt; {ok, Pid} | ignore | {error, Error}</tt><br></p>
</div><p>Starts the person manager server</p>

<h3 class="function"><a name="start_link-1">start_link/1</a></h3>
<div class="spec">
<p><tt>start_link(Args) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="stop-1">stop/1</a></h3>
<div class="spec">
<p><tt>stop(Pid) -&gt; any()</tt></p>
</div>

<h3 class="function"><a name="terminate-2">terminate/2</a></h3>
<div class="spec">
<p><tt>terminate(Reason, State) -&gt; <a href="#type-void">void()</a></tt><br></p>
</div><p>This function is called by a gen_server when it is about to
  terminate. It should be the opposite of Module:init/1 and do any necessary
  cleaning up. When it returns, the gen_server terminates with Reason.
  The return value is ignored.
  Terminate all processes coupled to the page.</p>

<h3 class="function"><a name="websocket_attach-2">websocket_attach/2</a></h3>
<div class="spec">
<p><tt>websocket_attach(WsPid, Context) -&gt; any()</tt></p>
</div><p>Attach the websocket request process to the page session, enabling sending scripts to the user agent</p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc, Apr 11 2012, 20:41:27.</i></p>
</body>
</html>
